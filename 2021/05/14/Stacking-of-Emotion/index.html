<!DOCTYPE html><html lang="zn-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Stacking集成学习案例一：幸福感预测 | LZMcosmos</title><meta name="keywords" content="Stacking集成学习案例一,幸福感预测"><meta name="author" content="李子梅"><meta name="copyright" content="李子梅"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="幸福感预测 本案例基于天池大赛上的：“快来一起挖掘幸福感”，比赛链接：传送门 1 赛题背景 在社会科学领域，幸福感的研究占有重要的位置。这个涉及了哲学、心理学、社会学、经济学等多方学科的话题复杂而有趣；同时与大家生活息息相关，每个人对幸福感都有自己的衡量标准。如果能发现影响幸福感的共性，生活中是不是将多一些乐趣；如果能找到影响幸福感的政策因素，便能优化资源配置来提升国民的幸福感。目前社会科学">
<meta property="og:type" content="article">
<meta property="og:title" content="Stacking集成学习案例一：幸福感预测">
<meta property="og:url" content="https://lzmcosmos.github.io/2021/05/14/Stacking-of-Emotion/index.html">
<meta property="og:site_name" content="LZMcosmos">
<meta property="og:description" content="幸福感预测 本案例基于天池大赛上的：“快来一起挖掘幸福感”，比赛链接：传送门 1 赛题背景 在社会科学领域，幸福感的研究占有重要的位置。这个涉及了哲学、心理学、社会学、经济学等多方学科的话题复杂而有趣；同时与大家生活息息相关，每个人对幸福感都有自己的衡量标准。如果能发现影响幸福感的共性，生活中是不是将多一些乐趣；如果能找到影响幸福感的政策因素，便能优化资源配置来提升国民的幸福感。目前社会科学">
<meta property="og:locale" content="zn_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg">
<meta property="article:published_time" content="2021-05-14T03:46:55.000Z">
<meta property="article:modified_time" content="2021-05-21T06:14:04.084Z">
<meta property="article:author" content="李子梅">
<meta property="article:tag" content="Stacking集成学习案例一">
<meta property="article:tag" content="幸福感预测">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="/img/cosmos.jpg"><link rel="canonical" href="https://lzmcosmos.github.io/2021/05/14/Stacking-of-Emotion/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="preconnect" href="//zz.bdstatic.com"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-05-21 14:14:04'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="generator" content="Hexo 5.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/cosmos.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">92</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">111</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">9</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/Nebula_planets-Universe.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">LZMcosmos</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><h1 class="post-title">Stacking集成学习案例一：幸福感预测</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-05-14T03:46:55.000Z" title="Created 2021-05-14 11:46:55">2021-05-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2021-05-21T06:14:04.084Z" title="Updated 2021-05-21 14:14:04">2021-05-21</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="幸福感预测">幸福感预测</h1>
<p>本案例基于天池大赛上的：“快来一起挖掘幸福感”，比赛链接：<a target="_blank" rel="noopener" href="https://tianchi.aliyun.com/competition/entrance/231702/introduction">传送门</a></p>
<h2 id="赛题背景">1 赛题背景</h2>
<p>在社会科学领域，幸福感的研究占有重要的位置。这个涉及了哲学、心理学、社会学、经济学等多方学科的话题复杂而有趣；同时与大家生活息息相关，每个人对幸福感都有自己的衡量标准。如果能发现影响幸福感的共性，生活中是不是将多一些乐趣；如果能找到影响幸福感的政策因素，便能优化资源配置来提升国民的幸福感。目前社会科学研究注重变量的可解释性和未来政策的落地，主要采用了线性回归和逻辑回归的方法，在收入、健康、职业、社交关系、休闲方式等经济人口因素；以及政府公共服务、宏观经济环境、税负等宏观因素上有了一系列的推测和发现。</p>
<p>赛题尝试了幸福感预测这一经典课题，希望在现有社会科学研究外有其他维度的算法尝试，结合多学科各自优势，挖掘潜在的影响因素，发现更多可解释、可理解的相关关系。</p>
<h2 id="赛题说明">2 赛题说明</h2>
<p>赛题使用公开数据的问卷调查结果，选取其中多组变量来预测其对<strong>幸福感的评价</strong>，包括：</p>
<ol type="1">
<li><strong>个体变量</strong>（性别、年龄、地域、职业、健康、婚姻与政治面貌等等）；</li>
<li><strong>家庭变量</strong>（父母、配偶、子女、家庭资本等等）；</li>
<li><strong>社会态度</strong>（公平、信用、公共服务等等）。</li>
</ol>
<p>幸福感预测的准确性不是赛题的唯一目的，更希望对变量间的关系、变量群的意义有所探索与收获。</p>
<h2 id="数据说明">3 数据说明</h2>
<p>考虑到变量个数较多、部分变量间关系复杂，数据分为<strong>完整版</strong>和<strong>精简版</strong>两类。可从精简版入手熟悉赛题后，使用完整版挖掘更多信息。</p>
<p>complete文件为变量完整版数据，abbr文件为变量精简版数据。完整的数据变量拥有139维的特征，共有8000组的训练样本用于幸福感预测(幸福感的值为：1, 2, 3, 4, 5，其中1代表幸福感最弱，5代表幸福感最强)</p>
<p>index文件中包含每个变量对应的问卷题目，以及变量取值的含义。</p>
<p>survey文件是数据源的原版问卷，作为补充以方便理解问题背景。</p>
<p><strong>数据来源</strong>：赛题使用的数据来自中国人民大学中国调查与数据中心主持之《中国综合社会调查（CGSS）》项目。赛题感谢此机构及其人员提供数据协助。中国综合社会调查为多阶分层抽样的截面面访调查。</p>
<p><strong>外部数据</strong>：赛题以数据挖掘和分析为出发点，不限制外部数据的使用，比如宏观经济指标、政府再分配政策等公开数据。</p>
<h2 id="评测指标">4 评测指标</h2>
<p>提交结果为csv文件，其中包含<code>id</code>和<code>happiness的预测值</code>两列。</p>
<p>根据真实值和提交结果中的<code>happiness的预测值</code>来计算得分score: <span class="math display">\[
score = \frac{1}{n}\sum_{n=1}^n (y_i - y^{*})^2
\]</span> 其中，<span class="math inline">\(n\)</span>代表测试集样本数量，<span class="math inline">\(y_i\)</span>代表第i个测试样本的预测值，<span class="math inline">\(y^*\)</span>代表该测试样本的真实值。</p>
<h2 id="案例分析和解决方案">5 案例分析和解决方案</h2>
<h3 id="导入项目所用包">5.1 导入项目所用包</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time </span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LogisticRegression</span><br><span class="line"><span class="keyword">from</span> sklearn.svm <span class="keyword">import</span> SVC, LinearSVC</span><br><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.neighbors <span class="keyword">import</span> KNeighborsClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.naive_bayes <span class="keyword">import</span> GaussianNB</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> Perceptron</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> SGDClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.tree <span class="keyword">import</span> DecisionTreeClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> metrics</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> roc_auc_score, roc_curve, mean_squared_error,mean_absolute_error, f1_score</span><br><span class="line"><span class="keyword">import</span> lightgbm <span class="keyword">as</span> lgb</span><br><span class="line"><span class="keyword">import</span> xgboost <span class="keyword">as</span> xgb</span><br><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestRegressor <span class="keyword">as</span> rfr</span><br><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> ExtraTreesRegressor <span class="keyword">as</span> etr</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> BayesianRidge <span class="keyword">as</span> br</span><br><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> GradientBoostingRegressor <span class="keyword">as</span> gbr</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> Ridge</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> Lasso</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LinearRegression <span class="keyword">as</span> lr</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> ElasticNet <span class="keyword">as</span> en</span><br><span class="line"><span class="keyword">from</span> sklearn.kernel_ridge <span class="keyword">import</span> KernelRidge <span class="keyword">as</span> kr</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span>  KFold, StratifiedKFold,GroupKFold, RepeatedKFold</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GridSearchCV</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> preprocessing</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"></span><br><span class="line">warnings.filterwarnings(<span class="string">&#x27;ignore&#x27;</span>) <span class="comment">#消除warning</span></span><br></pre></td></tr></table></figure>
<h3 id="导入数据集">5.2 导入数据集</h3>
<p>数据导入与观察： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">train = pd.read_csv(<span class="string">&quot;train.csv&quot;</span>, parse_dates=[<span class="string">&#x27;survey_time&#x27;</span>], encoding=<span class="string">&#x27;latin-1&#x27;</span>) <span class="comment">#latin-1向下兼容ASCII</span></span><br><span class="line">test = pd.read_csv(<span class="string">&quot;test.csv&quot;</span>, parse_dates=[<span class="string">&#x27;survey_time&#x27;</span>], encoding=<span class="string">&#x27;latin-1&#x27;</span>)</span><br><span class="line">train.describe()</span><br></pre></td></tr></table></figure> <img src="/img/Stacking_emotion_des.png" /></p>
<p>数据的目标值分割： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">train = train[train[<span class="string">&#x27;happiness&#x27;</span>]!=-<span class="number">8</span>].reset_index(drop=<span class="literal">True</span>) <span class="comment">## 删除&quot;happiness&quot; 为-8的行</span></span><br><span class="line">train_data_copy = train.copy()</span><br><span class="line">target_col = <span class="string">&#x27;happiness&#x27;</span></span><br><span class="line">target = train_data_copy[target_col]</span><br><span class="line"><span class="keyword">del</span> train_data_copy[target_col]</span><br><span class="line"></span><br><span class="line">data = pd.concat([train_data_copy, test], axis=<span class="number">0</span>, ignore_index=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure> ### 5.3 数据预处理</p>
<p>首先需要对于数据中连续出现的<strong>负数值</strong>进行处理。由于数据中的负数值只有：<code>-1</code>、<code>-2</code>、<code>-3</code>、<code>-8</code>这几种数值，所以对它们分别进行操作，实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#数据中有负数值：-1、-2、-3、-8，将他们视为有问题的特征，但是不删去</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getres1</span>(<span class="params">row</span>):</span></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">len</span>([x <span class="keyword">for</span> x <span class="keyword">in</span> row.values <span class="keyword">if</span> <span class="built_in">type</span>(x) == <span class="built_in">int</span> <span class="keyword">and</span> x &lt; <span class="number">0</span>])</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getres2</span>(<span class="params">row</span>):</span></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">len</span>([x <span class="keyword">for</span> x <span class="keyword">in</span> row.values <span class="keyword">if</span> <span class="built_in">type</span>(x) == <span class="built_in">int</span> <span class="keyword">and</span> x == -<span class="number">8</span>])</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getres3</span>(<span class="params">row</span>):</span></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">len</span>([x <span class="keyword">for</span> x <span class="keyword">in</span> row.values <span class="keyword">if</span> <span class="built_in">type</span>(x) == <span class="built_in">int</span> <span class="keyword">and</span> x == -<span class="number">1</span>])</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getres4</span>(<span class="params">row</span>):</span></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">len</span>([x <span class="keyword">for</span> x <span class="keyword">in</span> row.values <span class="keyword">if</span> <span class="built_in">type</span>(x) == <span class="built_in">int</span> <span class="keyword">and</span> x == -<span class="number">2</span>])</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getres5</span>(<span class="params">row</span>):</span></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">len</span>([x <span class="keyword">for</span> x <span class="keyword">in</span> row.values <span class="keyword">if</span> <span class="built_in">type</span>(x) == <span class="built_in">int</span> <span class="keyword">and</span> x == -<span class="number">3</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查数据</span></span><br><span class="line">data[<span class="string">&#x27;neg1&#x27;</span>] =  data[data.columns].apply(<span class="keyword">lambda</span> row:getres1(row), axis=<span class="number">1</span>)</span><br><span class="line">data.loc[data[<span class="string">&#x27;neg1&#x27;</span>]&gt;<span class="number">20</span>, <span class="string">&#x27;neg1&#x27;</span>] = <span class="number">20</span> <span class="comment">## 平滑处理</span></span><br><span class="line">data[<span class="string">&#x27;neg2&#x27;</span>] = data[data.columns].apply(<span class="keyword">lambda</span> row:getres2(row), aixs=<span class="number">1</span>)</span><br><span class="line">data[<span class="string">&#x27;neg3&#x27;</span>] = data[data.columns].apply(<span class="keyword">lambda</span> row:getres3(row),axis=<span class="number">1</span>)</span><br><span class="line">data[<span class="string">&#x27;neg4&#x27;</span>] = data[data.columns].apply(<span class="keyword">lambda</span> row:getres4(row),axis=<span class="number">1</span>)</span><br><span class="line">data[<span class="string">&#x27;neg5&#x27;</span>] = data[data.columns].apply(<span class="keyword">lambda</span> row:getres5(row),axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>接下来进行<strong>填充缺失值</strong>。在这里采取的方式是将缺失值<strong>补全</strong>，利用函数<code>fillna(value)</code>，其中value的数值根据具体的情况来定，例如：将大部分的缺失信息认为是0，将家庭成员数的缺失值填充为1，将家庭收入这个特征的缺失值填充为66365(即所有家庭的收入平均值)。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#填充缺失值 共25列 去掉4列 填充21列</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#以下的列都是缺省的，根据它们自己的情况进行填补</span></span><br><span class="line"></span><br><span class="line">data[<span class="string">&#x27;work_status&#x27;</span>] = data[<span class="string">&#x27;work_status&#x27;</span>].fillna(<span class="number">0</span>)</span><br><span class="line">data[<span class="string">&#x27;work_yr&#x27;</span>] = data[<span class="string">&#x27;work_yr&#x27;</span>].fillna(<span class="number">0</span>)</span><br><span class="line">data[<span class="string">&#x27;work_manage&#x27;</span>] = data[<span class="string">&#x27;work_manage&#x27;</span>].fillna(<span class="number">0</span>)</span><br><span class="line">data[<span class="string">&#x27;work_type&#x27;</span>] = data[<span class="string">&#x27;work_type&#x27;</span>].fillna(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">data[<span class="string">&#x27;edu_yr&#x27;</span>] = data[<span class="string">&#x27;edu_yr&#x27;</span>].fillna(<span class="number">0</span>)</span><br><span class="line">data[<span class="string">&#x27;edu_status&#x27;</span>] = data[<span class="string">&#x27;edu_status&#x27;</span>].fillna(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">data[<span class="string">&#x27;s_work_type&#x27;</span>] = data[<span class="string">&#x27;s_work_type&#x27;</span>].fillna(<span class="number">0</span>)</span><br><span class="line">data[<span class="string">&#x27;s_work_status&#x27;</span>] = data[<span class="string">&#x27;s_work_status&#x27;</span>].fillna(<span class="number">0</span>)</span><br><span class="line">data[<span class="string">&#x27;s_political&#x27;</span>] = data[<span class="string">&#x27;s_political&#x27;</span>].fillna(<span class="number">0</span>)</span><br><span class="line">data[<span class="string">&#x27;s_hukou&#x27;</span>] = data[<span class="string">&#x27;s_hukou&#x27;</span>].fillna(<span class="number">0</span>)</span><br><span class="line">data[<span class="string">&#x27;s_income&#x27;</span>] = data[<span class="string">&#x27;s_income&#x27;</span>].fillna(<span class="number">0</span>)</span><br><span class="line">data[<span class="string">&#x27;s_birth&#x27;</span>] = data[<span class="string">&#x27;s_birth&#x27;</span>].fillna(<span class="number">0</span>)</span><br><span class="line">data[<span class="string">&#x27;s_edu&#x27;</span>] = data[<span class="string">&#x27;s_edu&#x27;</span>].fillna(<span class="number">0</span>)</span><br><span class="line">data[<span class="string">&#x27;s_work_exper&#x27;</span>] = data[<span class="string">&#x27;s_work_exper&#x27;</span>].fillna(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">data[<span class="string">&#x27;minor_child&#x27;</span>] = data[<span class="string">&#x27;minor_child&#x27;</span>].fillna(<span class="number">0</span>)</span><br><span class="line">data[<span class="string">&#x27;marital_now&#x27;</span>] = data[<span class="string">&#x27;marital_now&#x27;</span>].fillna(<span class="number">0</span>)</span><br><span class="line">data[<span class="string">&#x27;marital_1st&#x27;</span>] = data[<span class="string">&#x27;marital_1st&#x27;</span>].fillna(<span class="number">0</span>)</span><br><span class="line">data[<span class="string">&#x27;social_neighbor&#x27;</span>]=data[<span class="string">&#x27;social_neighbor&#x27;</span>].fillna(<span class="number">0</span>)</span><br><span class="line">data[<span class="string">&#x27;social_friend&#x27;</span>]=data[<span class="string">&#x27;social_friend&#x27;</span>].fillna(<span class="number">0</span>)</span><br><span class="line">data[<span class="string">&#x27;hukou_loc&#x27;</span>]=data[<span class="string">&#x27;hukou_loc&#x27;</span>].fillna(<span class="number">1</span>) <span class="comment">#最少为1，表示户口</span></span><br><span class="line">data[<span class="string">&#x27;family_income&#x27;</span>]=data[<span class="string">&#x27;family_income&#x27;</span>].fillna(<span class="number">66365</span>) <span class="comment">#删除问题值后的平均值</span></span><br></pre></td></tr></table></figure>
<p>除了上面的处理，还有特殊格式的信息需要另外处理，比如时间。然后还要基于已有的出生日期和调查时间进行年龄的计算和年龄的分层。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data[<span class="string">&#x27;survey_time&#x27;</span>] = pd.to_datatime(data[<span class="string">&#x27;survey_time&#x27;</span>], <span class="built_in">format</span>=<span class="string">&#x27;%y-%m-%d&#x27;</span>, errors=<span class="string">&#x27;coerce&#x27;</span>)  <span class="comment">#防止时间格式不同的报错errors=&#x27;coerce&#x27;</span></span><br><span class="line">data[<span class="string">&#x27;survey_time&#x27;</span>] = data[<span class="string">&#x27;suyvey_time&#x27;</span>].dt.year <span class="comment">## 仅仅保留年份，方便计算年龄</span></span><br><span class="line">data[<span class="string">&#x27;age&#x27;</span>] = data[<span class="string">&#x27;survey_time&#x27;</span>] - data[<span class="string">&#x27;birth&#x27;</span>]</span><br><span class="line"></span><br><span class="line">bins = [<span class="number">0</span>, <span class="number">17</span>, <span class="number">26</span>, <span class="number">34</span>, <span class="number">50</span>, <span class="number">63</span>, <span class="number">100</span>]</span><br><span class="line">data[<span class="string">&#x27;age_bin&#x27;</span>] = pd.cut(data[<span class="string">&#x27;age&#x27;</span>], bins, labels=[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br></pre></td></tr></table></figure>
<p>对于有些特征的缺失值补全，可以采用的其他方式就是根据日常生活中的真实情况主观地进行补全。例如“宗教信息”特征为负数的认为是“不信仰宗教”，并认为“参加宗教活动的频率”为1，即没有参加过宗教活动。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#对‘宗教’处理</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;religion&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;religion&#x27;</span>] = <span class="number">1</span> <span class="comment">#1为不信仰宗教</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;religion_freq&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;religion_freq&#x27;</span>] = <span class="number">1</span> <span class="comment">#1为从来没有参加过</span></span><br><span class="line"><span class="comment">#对‘教育程度’处理</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;edu&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;edu&#x27;</span>] = <span class="number">4</span> <span class="comment">#初中</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;edu_status&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;edu_status&#x27;</span>] = <span class="number">0</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;edu_yr&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;edu_yr&#x27;</span>] = <span class="number">0</span></span><br><span class="line"><span class="comment">#对‘个人收入’处理</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;income&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;income&#x27;</span>] = <span class="number">0</span> <span class="comment">#认为无收入</span></span><br><span class="line"><span class="comment">#对‘政治面貌’处理</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;political&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;political&#x27;</span>] = <span class="number">1</span> <span class="comment">#认为是群众</span></span><br><span class="line"><span class="comment">#对体重处理（个人想法）</span></span><br><span class="line">data.loc[(data[<span class="string">&#x27;weight_jin&#x27;</span>]&lt;=<span class="number">80</span>)&amp;(data[<span class="string">&#x27;height_cm&#x27;</span>]&gt;=<span class="number">160</span>),<span class="string">&#x27;weight_jin&#x27;</span>]= data[<span class="string">&#x27;weight_jin&#x27;</span>]*<span class="number">2</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;weight_jin&#x27;</span>]&lt;=<span class="number">60</span>,<span class="string">&#x27;weight_jin&#x27;</span>]= data[<span class="string">&#x27;weight_jin&#x27;</span>]*<span class="number">2</span></span><br><span class="line"><span class="comment">#对身高处理</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;height_cm&#x27;</span>]&lt;<span class="number">150</span>,<span class="string">&#x27;height_cm&#x27;</span>] = <span class="number">150</span> <span class="comment">#成年人的实际情况</span></span><br><span class="line"><span class="comment">#对‘健康’处理</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;health&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;health&#x27;</span>] = <span class="number">4</span> <span class="comment">#认为是比较健康</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;health_problem&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;health_problem&#x27;</span>] = <span class="number">4</span></span><br><span class="line"><span class="comment">#对‘沮丧’处理</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;depression&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;depression&#x27;</span>] = <span class="number">4</span> <span class="comment">#一般人都是很少吧</span></span><br><span class="line"><span class="comment">#对‘媒体’处理</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;media_1&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;media_1&#x27;</span>] = <span class="number">1</span> <span class="comment">#都是从不</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;media_2&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;media_2&#x27;</span>] = <span class="number">1</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;media_3&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;media_3&#x27;</span>] = <span class="number">1</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;media_4&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;media_4&#x27;</span>] = <span class="number">1</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;media_5&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;media_5&#x27;</span>] = <span class="number">1</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;media_6&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;media_6&#x27;</span>] = <span class="number">1</span></span><br><span class="line"><span class="comment">#对‘空闲活动’处理</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;leisure_1&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;leisure_1&#x27;</span>] = <span class="number">1</span> <span class="comment">#根据自己的想法</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;leisure_2&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;leisure_2&#x27;</span>] = <span class="number">5</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;leisure_3&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;leisure_3&#x27;</span>] = <span class="number">3</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;socialize&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;socialize&#x27;</span>] = <span class="number">2</span> <span class="comment">#很少</span></span><br><span class="line"></span><br><span class="line">data.loc[data[<span class="string">&#x27;relax&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;relax&#x27;</span>] = <span class="number">4</span> <span class="comment">#经常</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;learn&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;learn&#x27;</span>] = <span class="number">1</span> <span class="comment">#从不</span></span><br><span class="line"><span class="comment">#对‘社交’处理</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;social_neighbor&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;social_neighbor&#x27;</span>] = <span class="number">0</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;social_friend&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;social_friend&#x27;</span>] = <span class="number">0</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;socia_outing&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;socia_outing&#x27;</span>] = <span class="number">1</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;neighbor_familiarity&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;social_neighbor&#x27;</span>]= <span class="number">4</span></span><br><span class="line"><span class="comment">#对‘社会公平性’处理</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;equity&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;equity&#x27;</span>] = <span class="number">4</span></span><br><span class="line"><span class="comment">#对‘社会等级’处理</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;class_10_before&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;class_10_before&#x27;</span>] = <span class="number">3</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;class&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;class&#x27;</span>] = <span class="number">5</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;class_10_after&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;class_10_after&#x27;</span>] = <span class="number">5</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;class_14&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;class_14&#x27;</span>] = <span class="number">2</span></span><br><span class="line"><span class="comment">#对‘工作情况’处理</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;work_status&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;work_status&#x27;</span>] = <span class="number">0</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;work_yr&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;work_yr&#x27;</span>] = <span class="number">0</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;work_manage&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;work_manage&#x27;</span>] = <span class="number">0</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;work_type&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;work_type&#x27;</span>] = <span class="number">0</span></span><br><span class="line"><span class="comment">#对‘社会保障’处理</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;insur_1&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;insur_1&#x27;</span>] = <span class="number">1</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;insur_2&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;insur_2&#x27;</span>] = <span class="number">1</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;insur_3&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;insur_3&#x27;</span>] = <span class="number">1</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;insur_4&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;insur_4&#x27;</span>] = <span class="number">1</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;insur_1&#x27;</span>]==<span class="number">0</span>,<span class="string">&#x27;insur_1&#x27;</span>] = <span class="number">0</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;insur_2&#x27;</span>]==<span class="number">0</span>,<span class="string">&#x27;insur_2&#x27;</span>] = <span class="number">0</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;insur_3&#x27;</span>]==<span class="number">0</span>,<span class="string">&#x27;insur_3&#x27;</span>] = <span class="number">0</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;insur_4&#x27;</span>]==<span class="number">0</span>,<span class="string">&#x27;insur_4&#x27;</span>] = <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>有的情况利用众数对缺失值进行处理会更加合理，使用众数函数<code>mode()</code>（来实现异常值的修正）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">data.loc[data[<span class="string">&#x27;leisure_4&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;leisure_4&#x27;</span>] = data[<span class="string">&#x27;leisure_4&#x27;</span>].mode() <span class="comment">#取众数</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;leisure_5&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;leisure_5&#x27;</span>] = data[<span class="string">&#x27;leisure_5&#x27;</span>].mode()</span><br><span class="line">data.loc[data[<span class="string">&#x27;leisure_6&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;leisure_6&#x27;</span>] = data[<span class="string">&#x27;leisure_6&#x27;</span>].mode()</span><br><span class="line">data.loc[data[<span class="string">&#x27;leisure_7&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;leisure_7&#x27;</span>] = data[<span class="string">&#x27;leisure_7&#x27;</span>].mode()</span><br><span class="line">data.loc[data[<span class="string">&#x27;leisure_8&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;leisure_8&#x27;</span>] = data[<span class="string">&#x27;leisure_8&#x27;</span>].mode()</span><br><span class="line">data.loc[data[<span class="string">&#x27;leisure_9&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;leisure_9&#x27;</span>] = data[<span class="string">&#x27;leisure_9&#x27;</span>].mode()</span><br><span class="line">data.loc[data[<span class="string">&#x27;leisure_10&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;leisure_10&#x27;</span>] = data[<span class="string">&#x27;leisure_10&#x27;</span>].mode()</span><br><span class="line">data.loc[data[<span class="string">&#x27;leisure_11&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;leisure_11&#x27;</span>] = data[<span class="string">&#x27;leisure_11&#x27;</span>].mode()</span><br><span class="line">data.loc[data[<span class="string">&#x27;leisure_12&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;leisure_12&#x27;</span>] = data[<span class="string">&#x27;leisure_12&#x27;</span>].mode()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>取均值进行缺失值的补全（代码实现为means()），在这里因为家庭的收入是连续值，所以不能再使用取众数的方法进行处理，这里就直接使用了均值进行缺失值的补全。 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">family_income_mean = data[<span class="string">&#x27;family_income&#x27;</span>].mean()</span><br><span class="line">data.loc[data[<span class="string">&#x27;family_income&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;family_income&#x27;</span>] = family_income_mean</span><br></pre></td></tr></table></figure> 其他缺失值处理：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#对家庭情况处理</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;family_m&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;family_m&#x27;</span>] = <span class="number">2</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;family_status&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;family_status&#x27;</span>] = <span class="number">3</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;house&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;house&#x27;</span>] = <span class="number">1</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;car&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;car&#x27;</span>] = <span class="number">0</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;car&#x27;</span>]==<span class="number">2</span>,<span class="string">&#x27;car&#x27;</span>] = <span class="number">0</span> <span class="comment">#变为0和1</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;son&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;son&#x27;</span>] = <span class="number">1</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;daughter&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;daughter&#x27;</span>] = <span class="number">0</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;minor_child&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;minor_child&#x27;</span>] = <span class="number">0</span></span><br><span class="line"><span class="comment">#对‘婚姻’处理</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;marital_1st&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;marital_1st&#x27;</span>] = <span class="number">0</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;marital_now&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;marital_now&#x27;</span>] = <span class="number">0</span></span><br><span class="line"><span class="comment">#对‘配偶’处理</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;s_birth&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;s_birth&#x27;</span>] = <span class="number">0</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;s_edu&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;s_edu&#x27;</span>] = <span class="number">0</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;s_political&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;s_political&#x27;</span>] = <span class="number">0</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;s_hukou&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;s_hukou&#x27;</span>] = <span class="number">0</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;s_income&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;s_income&#x27;</span>] = <span class="number">0</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;s_work_type&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;s_work_type&#x27;</span>] = <span class="number">0</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;s_work_status&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;s_work_status&#x27;</span>] = <span class="number">0</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;s_work_exper&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;s_work_exper&#x27;</span>] = <span class="number">0</span></span><br><span class="line"><span class="comment">#对‘父母情况’处理</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;f_birth&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;f_birth&#x27;</span>] = <span class="number">1945</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;f_edu&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;f_edu&#x27;</span>] = <span class="number">1</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;f_political&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;f_political&#x27;</span>] = <span class="number">1</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;f_work_14&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;f_work_14&#x27;</span>] = <span class="number">2</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;m_birth&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;m_birth&#x27;</span>] = <span class="number">1940</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;m_edu&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;m_edu&#x27;</span>] = <span class="number">1</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;m_political&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;m_political&#x27;</span>] = <span class="number">1</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;m_work_14&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;m_work_14&#x27;</span>] = <span class="number">2</span></span><br><span class="line"><span class="comment">#和同龄人相比社会经济地位</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;status_peer&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;status_peer&#x27;</span>] = <span class="number">2</span></span><br><span class="line"><span class="comment">#和3年前比社会经济地位</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;status_3_before&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;status_3_before&#x27;</span>] = <span class="number">2</span></span><br><span class="line"><span class="comment">#对‘观点’处理</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;view&#x27;</span>]&lt;<span class="number">0</span>,<span class="string">&#x27;view&#x27;</span>] = <span class="number">4</span></span><br><span class="line"><span class="comment">#对期望年收入处理</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;inc_ability&#x27;</span>]&lt;=<span class="number">0</span>,<span class="string">&#x27;inc_ability&#x27;</span>]= <span class="number">2</span></span><br><span class="line">inc_exp_mean = data[<span class="string">&#x27;inc_exp&#x27;</span>].mean()</span><br><span class="line">data.loc[data[<span class="string">&#x27;inc_exp&#x27;</span>]&lt;=<span class="number">0</span>,<span class="string">&#x27;inc_exp&#x27;</span>]= inc_exp_mean <span class="comment">#取均值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#部分特征处理，取众数（首先去除缺失值的数据）</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">9</span>+<span class="number">1</span>):</span><br><span class="line">    data.loc[data[<span class="string">&#x27;public_service_&#x27;</span>+<span class="built_in">str</span>(i)]&lt;<span class="number">0</span>,<span class="string">&#x27;public_service_&#x27;</span>+<span class="built_in">str</span>(i)] = data[<span class="string">&#x27;public_service_&#x27;</span>+<span class="built_in">str</span>(i)].dropna().mode().values</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">13</span>+<span class="number">1</span>):</span><br><span class="line">    data.loc[data[<span class="string">&#x27;trust_&#x27;</span>+<span class="built_in">str</span>(i)]&lt;<span class="number">0</span>,<span class="string">&#x27;trust_&#x27;</span>+<span class="built_in">str</span>(i)] = data[<span class="string">&#x27;trust_&#x27;</span>+<span class="built_in">str</span>(i)].dropna().mode().values</span><br></pre></td></tr></table></figure>
<h3 id="数据增广">5.4 数据增广</h3>
<p>为了更好地利用数据，需要进一步地分析，进行数据增广。<strong>通过分析每一个特征之间的关系，进行新特征的增加</strong>，比如：第一次结婚年龄、最近结婚年龄、是否再婚、配偶年龄、配偶年龄差、各种收入比（与配偶之间的收入比、十年后预期收入与现在收入之比等等）、收入与住房面积比（其中也包括10年后期望收入等等各种情况）、社会阶级（10年后的社会阶级、14年后的社会阶级等等）、悠闲指数、满意指数、信任指数等等。</p>
<p>除此之外，还考虑了同一省市内的收入的平均值等以及一个个体相对于同省、市、县其他人的各个指标的情况。同时也考虑了对于同龄人之间的相互比较，即在同龄人中的收入情况、健康情况等等。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#第一次结婚年龄 147</span></span><br><span class="line">data[<span class="string">&#x27;marital_1stbir&#x27;</span>] = data[<span class="string">&#x27;marital_1st&#x27;</span>] - data[<span class="string">&#x27;birth&#x27;</span>] </span><br><span class="line"><span class="comment">#最近结婚年龄 148</span></span><br><span class="line">data[<span class="string">&#x27;marital_nowtbir&#x27;</span>] = data[<span class="string">&#x27;marital_now&#x27;</span>] - data[<span class="string">&#x27;birth&#x27;</span>] </span><br><span class="line"><span class="comment">#是否再婚 149</span></span><br><span class="line">data[<span class="string">&#x27;mar&#x27;</span>] = data[<span class="string">&#x27;marital_nowtbir&#x27;</span>] - data[<span class="string">&#x27;marital_1stbir&#x27;</span>]</span><br><span class="line"><span class="comment">#配偶年龄 150</span></span><br><span class="line">data[<span class="string">&#x27;marital_sbir&#x27;</span>] = data[<span class="string">&#x27;marital_now&#x27;</span>]-data[<span class="string">&#x27;s_birth&#x27;</span>]</span><br><span class="line"><span class="comment">#配偶年龄差 151</span></span><br><span class="line">data[<span class="string">&#x27;age_&#x27;</span>] = data[<span class="string">&#x27;marital_nowtbir&#x27;</span>] - data[<span class="string">&#x27;marital_sbir&#x27;</span>] </span><br><span class="line"></span><br><span class="line"><span class="comment">#收入比 151+7 =158</span></span><br><span class="line">data[<span class="string">&#x27;income/s_income&#x27;</span>] = data[<span class="string">&#x27;income&#x27;</span>]/(data[<span class="string">&#x27;s_income&#x27;</span>]+<span class="number">1</span>) <span class="comment">#同居伴侣</span></span><br><span class="line">data[<span class="string">&#x27;income+s_income&#x27;</span>] = data[<span class="string">&#x27;income&#x27;</span>]+(data[<span class="string">&#x27;s_income&#x27;</span>]+<span class="number">1</span>)</span><br><span class="line">data[<span class="string">&#x27;income/family_income&#x27;</span>] = data[<span class="string">&#x27;income&#x27;</span>]/(data[<span class="string">&#x27;family_income&#x27;</span>]+<span class="number">1</span>)</span><br><span class="line">data[<span class="string">&#x27;all_income/family_income&#x27;</span>] = (data[<span class="string">&#x27;income&#x27;</span>]+data[<span class="string">&#x27;s_income&#x27;</span>])/(data[<span class="string">&#x27;family_income&#x27;</span>]+<span class="number">1</span>)</span><br><span class="line">data[<span class="string">&#x27;income/inc_exp&#x27;</span>] = data[<span class="string">&#x27;income&#x27;</span>]/(data[<span class="string">&#x27;inc_exp&#x27;</span>]+<span class="number">1</span>)</span><br><span class="line">data[<span class="string">&#x27;family_income/m&#x27;</span>] = data[<span class="string">&#x27;family_income&#x27;</span>]/(data[<span class="string">&#x27;family_m&#x27;</span>]+<span class="number">0.01</span>)</span><br><span class="line">data[<span class="string">&#x27;income/m&#x27;</span>] = data[<span class="string">&#x27;income&#x27;</span>]/(data[<span class="string">&#x27;family_m&#x27;</span>]+<span class="number">0.01</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#收入/面积比 158+4=162</span></span><br><span class="line">data[<span class="string">&#x27;income/floor_area&#x27;</span>] = data[<span class="string">&#x27;income&#x27;</span>]/(data[<span class="string">&#x27;floor_area&#x27;</span>]+<span class="number">0.01</span>)</span><br><span class="line">data[<span class="string">&#x27;all_income/floor_area&#x27;</span>] = (data[<span class="string">&#x27;income&#x27;</span>]+data[<span class="string">&#x27;s_income&#x27;</span>])/(data[<span class="string">&#x27;floor_area&#x27;</span>]+<span class="number">0.01</span>)</span><br><span class="line">data[<span class="string">&#x27;family_income/floor_area&#x27;</span>] = data[<span class="string">&#x27;family_income&#x27;</span>]/(data[<span class="string">&#x27;floor_area&#x27;</span>]+<span class="number">0.01</span>)</span><br><span class="line">data[<span class="string">&#x27;floor_area/m&#x27;</span>] = data[<span class="string">&#x27;floor_area&#x27;</span>]/(data[<span class="string">&#x27;family_m&#x27;</span>]+<span class="number">0.01</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#class 162+3=165</span></span><br><span class="line">data[<span class="string">&#x27;class_10_diff&#x27;</span>] = (data[<span class="string">&#x27;class_10_after&#x27;</span>] - data[<span class="string">&#x27;class&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;class_diff&#x27;</span>] = data[<span class="string">&#x27;class&#x27;</span>] - data[<span class="string">&#x27;class_10_before&#x27;</span>]</span><br><span class="line">data[<span class="string">&#x27;class_14_diff&#x27;</span>] = data[<span class="string">&#x27;class&#x27;</span>] - data[<span class="string">&#x27;class_14&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#悠闲指数 166</span></span><br><span class="line">leisure_fea_lis = [<span class="string">&#x27;leisure_&#x27;</span>+<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">13</span>)]</span><br><span class="line">data[<span class="string">&#x27;leisure_sum&#x27;</span>] = data[leisure_fea_lis].<span class="built_in">sum</span>(axis=<span class="number">1</span>) <span class="comment">#skew</span></span><br><span class="line"><span class="comment">#满意指数 167</span></span><br><span class="line">public_service_fea_lis = [<span class="string">&#x27;public_service_&#x27;</span>+<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10</span>)]</span><br><span class="line">data[<span class="string">&#x27;public_service_sum&#x27;</span>] = data[public_service_fea_lis].<span class="built_in">sum</span>(axis=<span class="number">1</span>) <span class="comment">#skew</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#信任指数 168</span></span><br><span class="line">trust_fea_lis = [<span class="string">&#x27;trust_&#x27;</span>+<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">14</span>)]</span><br><span class="line">data[<span class="string">&#x27;trust_sum&#x27;</span>] = data[trust_fea_lis].<span class="built_in">sum</span>(axis=<span class="number">1</span>) <span class="comment">#skew</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#province mean 168+13=181</span></span><br><span class="line">data[<span class="string">&#x27;province_income_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;province&#x27;</span>])[<span class="string">&#x27;income&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;province_family_income_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;province&#x27;</span>])[<span class="string">&#x27;family_income&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;province_equity_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;province&#x27;</span>])[<span class="string">&#x27;equity&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;province_depression_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;province&#x27;</span>])[<span class="string">&#x27;depression&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;province_floor_area_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;province&#x27;</span>])[<span class="string">&#x27;floor_area&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;province_health_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;province&#x27;</span>])[<span class="string">&#x27;health&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;province_class_10_diff_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;province&#x27;</span>])[<span class="string">&#x27;class_10_diff&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;province_class_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;province&#x27;</span>])[<span class="string">&#x27;class&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;province_health_problem_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;province&#x27;</span>])[<span class="string">&#x27;health_problem&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;province_family_status_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;province&#x27;</span>])[<span class="string">&#x27;family_status&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;province_leisure_sum_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;province&#x27;</span>])[<span class="string">&#x27;leisure_sum&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;province_public_service_sum_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;province&#x27;</span>])[<span class="string">&#x27;public_service_sum&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;province_trust_sum_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;province&#x27;</span>])[<span class="string">&#x27;trust_sum&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line"></span><br><span class="line"><span class="comment">#city   mean 181+13=194</span></span><br><span class="line">data[<span class="string">&#x27;city_income_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;city&#x27;</span>])[<span class="string">&#x27;income&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values <span class="comment">#按照city分组</span></span><br><span class="line">data[<span class="string">&#x27;city_family_income_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;city&#x27;</span>])[<span class="string">&#x27;family_income&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;city_equity_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;city&#x27;</span>])[<span class="string">&#x27;equity&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;city_depression_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;city&#x27;</span>])[<span class="string">&#x27;depression&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;city_floor_area_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;city&#x27;</span>])[<span class="string">&#x27;floor_area&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;city_health_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;city&#x27;</span>])[<span class="string">&#x27;health&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;city_class_10_diff_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;city&#x27;</span>])[<span class="string">&#x27;class_10_diff&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;city_class_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;city&#x27;</span>])[<span class="string">&#x27;class&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;city_health_problem_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;city&#x27;</span>])[<span class="string">&#x27;health_problem&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;city_family_status_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;city&#x27;</span>])[<span class="string">&#x27;family_status&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;city_leisure_sum_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;city&#x27;</span>])[<span class="string">&#x27;leisure_sum&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;city_public_service_sum_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;city&#x27;</span>])[<span class="string">&#x27;public_service_sum&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;city_trust_sum_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;city&#x27;</span>])[<span class="string">&#x27;trust_sum&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line"></span><br><span class="line"><span class="comment">#county  mean 194 + 13 = 207</span></span><br><span class="line">data[<span class="string">&#x27;county_income_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;county&#x27;</span>])[<span class="string">&#x27;income&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;county_family_income_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;county&#x27;</span>])[<span class="string">&#x27;family_income&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;county_equity_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;county&#x27;</span>])[<span class="string">&#x27;equity&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;county_depression_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;county&#x27;</span>])[<span class="string">&#x27;depression&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;county_floor_area_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;county&#x27;</span>])[<span class="string">&#x27;floor_area&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;county_health_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;county&#x27;</span>])[<span class="string">&#x27;health&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;county_class_10_diff_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;county&#x27;</span>])[<span class="string">&#x27;class_10_diff&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;county_class_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;county&#x27;</span>])[<span class="string">&#x27;class&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;county_health_problem_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;county&#x27;</span>])[<span class="string">&#x27;health_problem&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;county_family_status_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;county&#x27;</span>])[<span class="string">&#x27;family_status&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;county_leisure_sum_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;county&#x27;</span>])[<span class="string">&#x27;leisure_sum&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;county_public_service_sum_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;county&#x27;</span>])[<span class="string">&#x27;public_service_sum&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;county_trust_sum_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;county&#x27;</span>])[<span class="string">&#x27;trust_sum&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line"></span><br><span class="line"><span class="comment">#ratio 相比同省 207 + 13 =220</span></span><br><span class="line">data[<span class="string">&#x27;income/province&#x27;</span>] = data[<span class="string">&#x27;income&#x27;</span>]/(data[<span class="string">&#x27;province_income_mean&#x27;</span>])                                      </span><br><span class="line">data[<span class="string">&#x27;family_income/province&#x27;</span>] = data[<span class="string">&#x27;family_income&#x27;</span>]/(data[<span class="string">&#x27;province_family_income_mean&#x27;</span>])   </span><br><span class="line">data[<span class="string">&#x27;equity/province&#x27;</span>] = data[<span class="string">&#x27;equity&#x27;</span>]/(data[<span class="string">&#x27;province_equity_mean&#x27;</span>])       </span><br><span class="line">data[<span class="string">&#x27;depression/province&#x27;</span>] = data[<span class="string">&#x27;depression&#x27;</span>]/(data[<span class="string">&#x27;province_depression_mean&#x27;</span>])                                                </span><br><span class="line">data[<span class="string">&#x27;floor_area/province&#x27;</span>] = data[<span class="string">&#x27;floor_area&#x27;</span>]/(data[<span class="string">&#x27;province_floor_area_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;health/province&#x27;</span>] = data[<span class="string">&#x27;health&#x27;</span>]/(data[<span class="string">&#x27;province_health_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;class_10_diff/province&#x27;</span>] = data[<span class="string">&#x27;class_10_diff&#x27;</span>]/(data[<span class="string">&#x27;province_class_10_diff_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;class/province&#x27;</span>] = data[<span class="string">&#x27;class&#x27;</span>]/(data[<span class="string">&#x27;province_class_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;health_problem/province&#x27;</span>] = data[<span class="string">&#x27;health_problem&#x27;</span>]/(data[<span class="string">&#x27;province_health_problem_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;family_status/province&#x27;</span>] = data[<span class="string">&#x27;family_status&#x27;</span>]/(data[<span class="string">&#x27;province_family_status_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;leisure_sum/province&#x27;</span>] = data[<span class="string">&#x27;leisure_sum&#x27;</span>]/(data[<span class="string">&#x27;province_leisure_sum_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;public_service_sum/province&#x27;</span>] = data[<span class="string">&#x27;public_service_sum&#x27;</span>]/(data[<span class="string">&#x27;province_public_service_sum_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;trust_sum/province&#x27;</span>] = data[<span class="string">&#x27;trust_sum&#x27;</span>]/(data[<span class="string">&#x27;province_trust_sum_mean&#x27;</span>]+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ratio 相比同市 220 + 13 =233</span></span><br><span class="line">data[<span class="string">&#x27;income/city&#x27;</span>] = data[<span class="string">&#x27;income&#x27;</span>]/(data[<span class="string">&#x27;city_income_mean&#x27;</span>])                                      </span><br><span class="line">data[<span class="string">&#x27;family_income/city&#x27;</span>] = data[<span class="string">&#x27;family_income&#x27;</span>]/(data[<span class="string">&#x27;city_family_income_mean&#x27;</span>])   </span><br><span class="line">data[<span class="string">&#x27;equity/city&#x27;</span>] = data[<span class="string">&#x27;equity&#x27;</span>]/(data[<span class="string">&#x27;city_equity_mean&#x27;</span>])       </span><br><span class="line">data[<span class="string">&#x27;depression/city&#x27;</span>] = data[<span class="string">&#x27;depression&#x27;</span>]/(data[<span class="string">&#x27;city_depression_mean&#x27;</span>])                                                </span><br><span class="line">data[<span class="string">&#x27;floor_area/city&#x27;</span>] = data[<span class="string">&#x27;floor_area&#x27;</span>]/(data[<span class="string">&#x27;city_floor_area_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;health/city&#x27;</span>] = data[<span class="string">&#x27;health&#x27;</span>]/(data[<span class="string">&#x27;city_health_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;class_10_diff/city&#x27;</span>] = data[<span class="string">&#x27;class_10_diff&#x27;</span>]/(data[<span class="string">&#x27;city_class_10_diff_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;class/city&#x27;</span>] = data[<span class="string">&#x27;class&#x27;</span>]/(data[<span class="string">&#x27;city_class_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;health_problem/city&#x27;</span>] = data[<span class="string">&#x27;health_problem&#x27;</span>]/(data[<span class="string">&#x27;city_health_problem_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;family_status/city&#x27;</span>] = data[<span class="string">&#x27;family_status&#x27;</span>]/(data[<span class="string">&#x27;city_family_status_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;leisure_sum/city&#x27;</span>] = data[<span class="string">&#x27;leisure_sum&#x27;</span>]/(data[<span class="string">&#x27;city_leisure_sum_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;public_service_sum/city&#x27;</span>] = data[<span class="string">&#x27;public_service_sum&#x27;</span>]/(data[<span class="string">&#x27;city_public_service_sum_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;trust_sum/city&#x27;</span>] = data[<span class="string">&#x27;trust_sum&#x27;</span>]/(data[<span class="string">&#x27;city_trust_sum_mean&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">#ratio 相比同个地区 233 + 13 =246</span></span><br><span class="line">data[<span class="string">&#x27;income/county&#x27;</span>] = data[<span class="string">&#x27;income&#x27;</span>]/(data[<span class="string">&#x27;county_income_mean&#x27;</span>])                                      </span><br><span class="line">data[<span class="string">&#x27;family_income/county&#x27;</span>] = data[<span class="string">&#x27;family_income&#x27;</span>]/(data[<span class="string">&#x27;county_family_income_mean&#x27;</span>])   </span><br><span class="line">data[<span class="string">&#x27;equity/county&#x27;</span>] = data[<span class="string">&#x27;equity&#x27;</span>]/(data[<span class="string">&#x27;county_equity_mean&#x27;</span>])       </span><br><span class="line">data[<span class="string">&#x27;depression/county&#x27;</span>] = data[<span class="string">&#x27;depression&#x27;</span>]/(data[<span class="string">&#x27;county_depression_mean&#x27;</span>])                                                </span><br><span class="line">data[<span class="string">&#x27;floor_area/county&#x27;</span>] = data[<span class="string">&#x27;floor_area&#x27;</span>]/(data[<span class="string">&#x27;county_floor_area_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;health/county&#x27;</span>] = data[<span class="string">&#x27;health&#x27;</span>]/(data[<span class="string">&#x27;county_health_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;class_10_diff/county&#x27;</span>] = data[<span class="string">&#x27;class_10_diff&#x27;</span>]/(data[<span class="string">&#x27;county_class_10_diff_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;class/county&#x27;</span>] = data[<span class="string">&#x27;class&#x27;</span>]/(data[<span class="string">&#x27;county_class_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;health_problem/county&#x27;</span>] = data[<span class="string">&#x27;health_problem&#x27;</span>]/(data[<span class="string">&#x27;county_health_problem_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;family_status/county&#x27;</span>] = data[<span class="string">&#x27;family_status&#x27;</span>]/(data[<span class="string">&#x27;county_family_status_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;leisure_sum/county&#x27;</span>] = data[<span class="string">&#x27;leisure_sum&#x27;</span>]/(data[<span class="string">&#x27;county_leisure_sum_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;public_service_sum/county&#x27;</span>] = data[<span class="string">&#x27;public_service_sum&#x27;</span>]/(data[<span class="string">&#x27;county_public_service_sum_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;trust_sum/county&#x27;</span>] = data[<span class="string">&#x27;trust_sum&#x27;</span>]/(data[<span class="string">&#x27;county_trust_sum_mean&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">#age   mean 246+ 13 =259</span></span><br><span class="line">data[<span class="string">&#x27;age_income_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;age&#x27;</span>])[<span class="string">&#x27;income&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;age_family_income_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;age&#x27;</span>])[<span class="string">&#x27;family_income&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;age_equity_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;age&#x27;</span>])[<span class="string">&#x27;equity&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;age_depression_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;age&#x27;</span>])[<span class="string">&#x27;depression&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;age_floor_area_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;age&#x27;</span>])[<span class="string">&#x27;floor_area&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;age_health_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;age&#x27;</span>])[<span class="string">&#x27;health&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;age_class_10_diff_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;age&#x27;</span>])[<span class="string">&#x27;class_10_diff&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;age_class_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;age&#x27;</span>])[<span class="string">&#x27;class&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;age_health_problem_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;age&#x27;</span>])[<span class="string">&#x27;health_problem&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;age_family_status_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;age&#x27;</span>])[<span class="string">&#x27;family_status&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;age_leisure_sum_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;age&#x27;</span>])[<span class="string">&#x27;leisure_sum&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;age_public_service_sum_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;age&#x27;</span>])[<span class="string">&#x27;public_service_sum&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line">data[<span class="string">&#x27;age_trust_sum_mean&#x27;</span>] = data.groupby([<span class="string">&#x27;age&#x27;</span>])[<span class="string">&#x27;trust_sum&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>).values</span><br><span class="line"></span><br><span class="line"><span class="comment"># 和同龄人相比259 + 13 =272</span></span><br><span class="line">data[<span class="string">&#x27;income/age&#x27;</span>] = data[<span class="string">&#x27;income&#x27;</span>]/(data[<span class="string">&#x27;age_income_mean&#x27;</span>])                                      </span><br><span class="line">data[<span class="string">&#x27;family_income/age&#x27;</span>] = data[<span class="string">&#x27;family_income&#x27;</span>]/(data[<span class="string">&#x27;age_family_income_mean&#x27;</span>])   </span><br><span class="line">data[<span class="string">&#x27;equity/age&#x27;</span>] = data[<span class="string">&#x27;equity&#x27;</span>]/(data[<span class="string">&#x27;age_equity_mean&#x27;</span>])       </span><br><span class="line">data[<span class="string">&#x27;depression/age&#x27;</span>] = data[<span class="string">&#x27;depression&#x27;</span>]/(data[<span class="string">&#x27;age_depression_mean&#x27;</span>])                                                </span><br><span class="line">data[<span class="string">&#x27;floor_area/age&#x27;</span>] = data[<span class="string">&#x27;floor_area&#x27;</span>]/(data[<span class="string">&#x27;age_floor_area_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;health/age&#x27;</span>] = data[<span class="string">&#x27;health&#x27;</span>]/(data[<span class="string">&#x27;age_health_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;class_10_diff/age&#x27;</span>] = data[<span class="string">&#x27;class_10_diff&#x27;</span>]/(data[<span class="string">&#x27;age_class_10_diff_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;class/age&#x27;</span>] = data[<span class="string">&#x27;class&#x27;</span>]/(data[<span class="string">&#x27;age_class_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;health_problem/age&#x27;</span>] = data[<span class="string">&#x27;health_problem&#x27;</span>]/(data[<span class="string">&#x27;age_health_problem_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;family_status/age&#x27;</span>] = data[<span class="string">&#x27;family_status&#x27;</span>]/(data[<span class="string">&#x27;age_family_status_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;leisure_sum/age&#x27;</span>] = data[<span class="string">&#x27;leisure_sum&#x27;</span>]/(data[<span class="string">&#x27;age_leisure_sum_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;public_service_sum/age&#x27;</span>] = data[<span class="string">&#x27;public_service_sum&#x27;</span>]/(data[<span class="string">&#x27;age_public_service_sum_mean&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;trust_sum/age&#x27;</span>] = data[<span class="string">&#x27;trust_sum&#x27;</span>]/(data[<span class="string">&#x27;age_trust_sum_mean&#x27;</span>])</span><br></pre></td></tr></table></figure>
<p>经过如上的操作后，最终我们的特征从一开始的131维，扩充为了272维的特征。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">&#x27;shape&#x27;</span>,data.shape)</span><br></pre></td></tr></table></figure>
<p>输出：<code>shape (10956, 272)</code></p>
<p>对于有效样本数很少的特征，例如负值太多的特征或者是缺失值太多的特征，进行删除。一共删除了包括“目前的最高教育程度”在内的9类特征，得到了最终的263维的特征。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除数值特别少的和之前用过的特征</span></span><br><span class="line">del_list=[<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;survey_time&#x27;</span>,<span class="string">&#x27;edu_other&#x27;</span>,<span class="string">&#x27;invest_other&#x27;</span>,<span class="string">&#x27;property_other&#x27;</span>,<span class="string">&#x27;join_party&#x27;</span>,<span class="string">&#x27;province&#x27;</span>,<span class="string">&#x27;city&#x27;</span>,<span class="string">&#x27;county&#x27;</span>]</span><br><span class="line">use_feature = [clo <span class="keyword">for</span> clo <span class="keyword">in</span> data.columns <span class="keyword">if</span> clo <span class="keyword">not</span> <span class="keyword">in</span> del_list]</span><br><span class="line">data.fillna(<span class="number">0</span>,inplace=<span class="literal">True</span>) <span class="comment">#还是补0</span></span><br><span class="line">train_shape = train.shape[<span class="number">0</span>] <span class="comment">#一共的数据量，训练集</span></span><br><span class="line">features = data[use_feature].columns <span class="comment">#删除后所有的特征</span></span><br><span class="line">X_train_263 = data[:train_shape][use_feature].values</span><br><span class="line">y_train = target</span><br><span class="line">X_test_263 = data[train_shape:][use_feature].values</span><br><span class="line">X_train_263.shape <span class="comment">#最终一种263个特征</span></span><br></pre></td></tr></table></figure>
<p>输出：<code>(7988, 263)</code></p>
<p>这里选择了最重要的49个特征，作为除了以上263维特征外的另外一组特征。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">imp_fea_49 = [<span class="string">&#x27;equity&#x27;</span>,<span class="string">&#x27;depression&#x27;</span>,<span class="string">&#x27;health&#x27;</span>,<span class="string">&#x27;class&#x27;</span>,<span class="string">&#x27;family_status&#x27;</span>,<span class="string">&#x27;health_problem&#x27;</span>,<span class="string">&#x27;class_10_after&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;equity/province&#x27;</span>,<span class="string">&#x27;equity/city&#x27;</span>,<span class="string">&#x27;equity/county&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;depression/province&#x27;</span>,<span class="string">&#x27;depression/city&#x27;</span>,<span class="string">&#x27;depression/county&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;health/province&#x27;</span>,<span class="string">&#x27;health/city&#x27;</span>,<span class="string">&#x27;health/county&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;class/province&#x27;</span>,<span class="string">&#x27;class/city&#x27;</span>,<span class="string">&#x27;class/county&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;family_status/province&#x27;</span>,<span class="string">&#x27;family_status/city&#x27;</span>,<span class="string">&#x27;family_status/county&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;family_income/province&#x27;</span>,<span class="string">&#x27;family_income/city&#x27;</span>,<span class="string">&#x27;family_income/county&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;floor_area/province&#x27;</span>,<span class="string">&#x27;floor_area/city&#x27;</span>,<span class="string">&#x27;floor_area/county&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;leisure_sum/province&#x27;</span>,<span class="string">&#x27;leisure_sum/city&#x27;</span>,<span class="string">&#x27;leisure_sum/county&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;public_service_sum/province&#x27;</span>,<span class="string">&#x27;public_service_sum/city&#x27;</span>,<span class="string">&#x27;public_service_sum/county&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;trust_sum/province&#x27;</span>,<span class="string">&#x27;trust_sum/city&#x27;</span>,<span class="string">&#x27;trust_sum/county&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;income/m&#x27;</span>,<span class="string">&#x27;public_service_sum&#x27;</span>,<span class="string">&#x27;class_diff&#x27;</span>,<span class="string">&#x27;status_3_before&#x27;</span>,<span class="string">&#x27;age_income_mean&#x27;</span>,<span class="string">&#x27;age_floor_area_mean&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;weight_jin&#x27;</span>,<span class="string">&#x27;height_cm&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;health/age&#x27;</span>,<span class="string">&#x27;depression/age&#x27;</span>,<span class="string">&#x27;equity/age&#x27;</span>,<span class="string">&#x27;leisure_sum/age&#x27;</span></span><br><span class="line">          ]</span><br><span class="line">train_shape = train.shape[<span class="number">0</span>]</span><br><span class="line">X_train_49 = data[:train_shape][imp_fea_49].values</span><br><span class="line">X_test_49 = data[train_shape:][imp_fea_49].values</span><br><span class="line">X_train_49.shape <span class="comment">#最重要的49个特征</span></span><br></pre></td></tr></table></figure>
<p>输出：<code>(7988, 49)</code></p>
<p>选择需要进行onehot编码的离散变量进行one-hot编码，再合成为第三类特征，共383维。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat_fea = [<span class="string">&#x27;survey_type&#x27;</span>,<span class="string">&#x27;gender&#x27;</span>,<span class="string">&#x27;nationality&#x27;</span>,<span class="string">&#x27;edu_status&#x27;</span>,<span class="string">&#x27;political&#x27;</span>,<span class="string">&#x27;hukou&#x27;</span>,<span class="string">&#x27;hukou_loc&#x27;</span>,<span class="string">&#x27;work_exper&#x27;</span>,<span class="string">&#x27;work_status&#x27;</span>,<span class="string">&#x27;work_type&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;work_manage&#x27;</span>,<span class="string">&#x27;marital&#x27;</span>,<span class="string">&#x27;s_political&#x27;</span>,<span class="string">&#x27;s_hukou&#x27;</span>,<span class="string">&#x27;s_work_exper&#x27;</span>,<span class="string">&#x27;s_work_status&#x27;</span>,<span class="string">&#x27;s_work_type&#x27;</span>,<span class="string">&#x27;f_political&#x27;</span>,<span class="string">&#x27;f_work_14&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;m_political&#x27;</span>,<span class="string">&#x27;m_work_14&#x27;</span>] <span class="comment">#已经是0、1的值不需要onehot</span></span><br><span class="line">noc_fea = [clo <span class="keyword">for</span> clo <span class="keyword">in</span> use_feature <span class="keyword">if</span> clo <span class="keyword">not</span> <span class="keyword">in</span> cat_fea]</span><br><span class="line"></span><br><span class="line">onehot_data = data[cat_fea].values</span><br><span class="line">enc = preprocessing.OneHotEncoder(categories = <span class="string">&#x27;auto&#x27;</span>)</span><br><span class="line">oh_data=enc.fit_transform(onehot_data).toarray()</span><br><span class="line">oh_data.shape <span class="comment">#变为onehot编码格式</span></span><br><span class="line"></span><br><span class="line">X_train_oh = oh_data[:train_shape,:]</span><br><span class="line">X_test_oh = oh_data[train_shape:,:]</span><br><span class="line">X_train_oh.shape <span class="comment">#其中的训练集</span></span><br><span class="line"></span><br><span class="line">X_train_383 = np.column_stack([data[:train_shape][noc_fea].values,X_train_oh])<span class="comment">#先是noc，再是cat_fea</span></span><br><span class="line">X_test_383 = np.column_stack([data[train_shape:][noc_fea].values,X_test_oh])</span><br><span class="line">X_train_383.shape</span><br></pre></td></tr></table></figure>
<p>输出：<code>(7988, 383)</code></p>
<p>基于此，我们构建完成了三种特征工程（训练数据集），其一是上面提取的最重要的49中特征，其中包括健康程度、社会阶级、在同龄人中的收入情况等等特征。其二是扩充后的263维特征（这里可以认为是初始特征）。其三是使用One-hot编码后的特征，这里要使用One-hot进行编码的原因在于，有部分特征为分离值，例如性别中男女，男为1，女为2，我们想使用One-hot将其变为男为0，女为1，来增强机器学习算法的鲁棒性能；再如民族这个特征，原本是1-56这56个数值，如果直接分类会让分类器的鲁棒性变差，所以使用One-hot编码将其变为6个特征进行非零即一的处理。</p>
<h3 id="特征建模">5.5 特征建模</h3>
<ul>
<li><strong>对于263维的特征</strong></li>
</ul>
<p><strong>1. lightGBM</strong></p>
<p>首先我们对于原始的263维的特征，使用lightGBM进行处理，这里使用5折交叉验证的方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#lightGBM决策树</span></span><br><span class="line">lgb_263_param = &#123;</span><br><span class="line"><span class="string">&#x27;num_leaves&#x27;</span>: <span class="number">7</span>, </span><br><span class="line"><span class="string">&#x27;min_data_in_leaf&#x27;</span>: <span class="number">20</span>, <span class="comment">#叶子可能具有的最小记录数</span></span><br><span class="line"><span class="string">&#x27;objective&#x27;</span>:<span class="string">&#x27;regression&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;max_depth&#x27;</span>: -<span class="number">1</span>,</span><br><span class="line"><span class="string">&#x27;learning_rate&#x27;</span>: <span class="number">0.003</span>,</span><br><span class="line"><span class="string">&quot;boosting&quot;</span>: <span class="string">&quot;gbdt&quot;</span>, <span class="comment">#用gbdt算法</span></span><br><span class="line"><span class="string">&quot;feature_fraction&quot;</span>: <span class="number">0.18</span>, <span class="comment">#例如 0.18时，意味着在每次迭代中随机选择18％的参数来建树</span></span><br><span class="line"><span class="string">&quot;bagging_freq&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="string">&quot;bagging_fraction&quot;</span>: <span class="number">0.55</span>, <span class="comment">#每次迭代时用的数据比例</span></span><br><span class="line"><span class="string">&quot;bagging_seed&quot;</span>: <span class="number">14</span>,</span><br><span class="line"><span class="string">&quot;metric&quot;</span>: <span class="string">&#x27;mse&#x27;</span>,</span><br><span class="line"><span class="string">&quot;lambda_l1&quot;</span>: <span class="number">0.1</span>,</span><br><span class="line"><span class="string">&quot;lambda_l2&quot;</span>: <span class="number">0.2</span>, </span><br><span class="line"><span class="string">&quot;verbosity&quot;</span>: -<span class="number">1</span>&#125;</span><br><span class="line">folds = StratifiedKFold(n_splits=<span class="number">5</span>, shuffle=<span class="literal">True</span>, random_state=<span class="number">4</span>)   <span class="comment">#交叉切分：5</span></span><br><span class="line">oof_lgb_263 = np.zeros(<span class="built_in">len</span>(X_train_263))</span><br><span class="line">predictions_lgb_263 = np.zeros(<span class="built_in">len</span>(X_test_263))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> fold_, (trn_idx, val_idx) <span class="keyword">in</span> <span class="built_in">enumerate</span>(folds.split(X_train_263, y_train)):</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;fold n°&#123;&#125;&quot;</span>.<span class="built_in">format</span>(fold_+<span class="number">1</span>))</span><br><span class="line">    trn_data = lgb.Dataset(X_train_263[trn_idx], y_train[trn_idx])</span><br><span class="line">    val_data = lgb.Dataset(X_train_263[val_idx], y_train[val_idx])<span class="comment">#train:val=4:1</span></span><br><span class="line"></span><br><span class="line">    num_round = <span class="number">10000</span></span><br><span class="line">    lgb_263 = lgb.train(lgb_263_param, trn_data, num_round, valid_sets = [trn_data, val_data], verbose_eval=<span class="number">500</span>, early_stopping_rounds = <span class="number">800</span>)</span><br><span class="line">    oof_lgb_263[val_idx] = lgb_263.predict(X_train_263[val_idx], num_iteration=lgb_263.best_iteration)</span><br><span class="line">    predictions_lgb_263 += lgb_263.predict(X_test_263, num_iteration=lgb_263.best_iteration) / folds.n_splits</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;CV score: &#123;:&lt;8.8f&#125;&quot;</span>.<span class="built_in">format</span>(mean_squared_error(oof_lgb_263, target)))</span><br></pre></td></tr></table></figure>
<p>使用已经训练完的lightGBM的模型进行特征重要性的判断以及可视化。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#---------------特征重要性</span></span><br><span class="line">pd.set_option(<span class="string">&#x27;display.max_columns&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line"><span class="comment">#显示所有行</span></span><br><span class="line">pd.set_option(<span class="string">&#x27;display.max_rows&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line"><span class="comment">#设置value的显示长度为100，默认为50</span></span><br><span class="line">pd.set_option(<span class="string">&#x27;max_colwidth&#x27;</span>,<span class="number">100</span>)</span><br><span class="line">df = pd.DataFrame(data[use_feature].columns.tolist(), columns=[<span class="string">&#x27;feature&#x27;</span>])</span><br><span class="line">df[<span class="string">&#x27;importance&#x27;</span>]=<span class="built_in">list</span>(lgb_263.feature_importance())</span><br><span class="line">df = df.sort_values(by=<span class="string">&#x27;importance&#x27;</span>,ascending=<span class="literal">False</span>)</span><br><span class="line">plt.figure(figsize=(<span class="number">14</span>,<span class="number">28</span>))</span><br><span class="line">sns.barplot(x=<span class="string">&quot;importance&quot;</span>, y=<span class="string">&quot;feature&quot;</span>, data=df.head(<span class="number">50</span>))</span><br><span class="line">plt.title(<span class="string">&#x27;Features importance (averaged/folds)&#x27;</span>)</span><br><span class="line">plt.tight_layout()</span><br></pre></td></tr></table></figure>
<p><img src="/img/stacking_emotion_feature_importance.png" /></p>
<p><strong>2. xgboost</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#xgboost</span></span><br><span class="line">xgb_263_params = &#123;<span class="string">&#x27;eta&#x27;</span>: <span class="number">0.02</span>,  <span class="comment">#lr</span></span><br><span class="line">              <span class="string">&#x27;max_depth&#x27;</span>: <span class="number">6</span>,  </span><br><span class="line">              <span class="string">&#x27;min_child_weight&#x27;</span>:<span class="number">3</span>,<span class="comment">#最小叶子节点样本权重和</span></span><br><span class="line">              <span class="string">&#x27;gamma&#x27;</span>:<span class="number">0</span>, <span class="comment">#指定节点分裂所需的最小损失函数下降值。</span></span><br><span class="line">              <span class="string">&#x27;subsample&#x27;</span>: <span class="number">0.7</span>,  <span class="comment">#控制对于每棵树，随机采样的比例</span></span><br><span class="line">              <span class="string">&#x27;colsample_bytree&#x27;</span>: <span class="number">0.3</span>,  <span class="comment">#用来控制每棵随机采样的列数的占比 (每一列是一个特征)。</span></span><br><span class="line">              <span class="string">&#x27;lambda&#x27;</span>:<span class="number">2</span>,</span><br><span class="line">              <span class="string">&#x27;objective&#x27;</span>: <span class="string">&#x27;reg:linear&#x27;</span>, </span><br><span class="line">              <span class="string">&#x27;eval_metric&#x27;</span>: <span class="string">&#x27;rmse&#x27;</span>, </span><br><span class="line">              <span class="string">&#x27;silent&#x27;</span>: <span class="literal">True</span>, </span><br><span class="line">              <span class="string">&#x27;nthread&#x27;</span>: -<span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">folds = StratifiedKFold(n_splits=<span class="number">5</span>, shuffle=<span class="literal">True</span>, random_state=<span class="number">2019</span>)</span><br><span class="line">oof_xgb_263 = np.zeros(<span class="built_in">len</span>(X_train_263))</span><br><span class="line">predictions_xgb_263 = np.zeros(<span class="built_in">len</span>(X_test_263))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> fold_, (trn_idx, val_idx) <span class="keyword">in</span> <span class="built_in">enumerate</span>(folds.split(X_train_263, y_train)):</span><br><span class="line">    print(<span class="string">&quot;fold n°&#123;&#125;&quot;</span>.<span class="built_in">format</span>(fold_+<span class="number">1</span>))</span><br><span class="line">    trn_data = xgb.DMatrix(X_train_263[trn_idx], y_train[trn_idx])</span><br><span class="line">    val_data = xgb.DMatrix(X_train_263[val_idx], y_train[val_idx])</span><br><span class="line"></span><br><span class="line">    watchlist = [(trn_data, <span class="string">&#x27;train&#x27;</span>), (val_data, <span class="string">&#x27;valid_data&#x27;</span>)]</span><br><span class="line">    xgb_263 = xgb.train(dtrain=trn_data, num_boost_round=<span class="number">3000</span>, evals=watchlist, early_stopping_rounds=<span class="number">600</span>, verbose_eval=<span class="number">500</span>, params=xgb_263_params)</span><br><span class="line">    oof_xgb_263[val_idx] = xgb_263.predict(xgb.DMatrix(X_train_263[val_idx]), ntree_limit=xgb_263.best_ntree_limit)</span><br><span class="line">    predictions_xgb_263 += xgb_263.predict(xgb.DMatrix(X_test_263), ntree_limit=xgb_263.best_ntree_limit) / folds.n_splits</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;CV score: &#123;:&lt;8.8f&#125;&quot;</span>.<span class="built_in">format</span>(mean_squared_error(oof_xgb_263, target)))</span><br></pre></td></tr></table></figure>
<p><strong>3. RandomForest 随机森林</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#RandomForestRegressor随机森林</span></span><br><span class="line">folds = KFold(n_splits=<span class="number">5</span>, shuffle=<span class="literal">True</span>, random_state=<span class="number">2019</span>)</span><br><span class="line">oof_rfr_263 = np.zeros(<span class="built_in">len</span>(X_train_263))</span><br><span class="line">predictions_rfr_263 = np.zeros(<span class="built_in">len</span>(X_test_263))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> fold_, (trn_idx, val_idx) <span class="keyword">in</span> <span class="built_in">enumerate</span>(folds.split(X_train_263, y_train)):</span><br><span class="line">    print(<span class="string">&quot;fold n°&#123;&#125;&quot;</span>.<span class="built_in">format</span>(fold_+<span class="number">1</span>))</span><br><span class="line">    tr_x = X_train_263[trn_idx]</span><br><span class="line">    tr_y = y_train[trn_idx]</span><br><span class="line">    rfr_263 = rfr(n_estimators=<span class="number">1600</span>,max_depth=<span class="number">9</span>, min_samples_leaf=<span class="number">9</span>, min_weight_fraction_leaf=<span class="number">0.0</span>,</span><br><span class="line">            max_features=<span class="number">0.25</span>,verbose=<span class="number">1</span>,n_jobs=-<span class="number">1</span>) <span class="comment">#并行化</span></span><br><span class="line">    <span class="comment">#verbose = 0 为不在标准输出流输出日志信息</span></span><br><span class="line"><span class="comment">#verbose = 1 为输出进度条记录</span></span><br><span class="line"><span class="comment">#verbose = 2 为每个epoch输出一行记录</span></span><br><span class="line">    rfr_263.fit(tr_x,tr_y)</span><br><span class="line">    oof_rfr_263[val_idx] = rfr_263.predict(X_train_263[val_idx])</span><br><span class="line">    </span><br><span class="line">    predictions_rfr_263 += rfr_263.predict(X_test_263) / folds.n_splits</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;CV score: &#123;:&lt;8.8f&#125;&quot;</span>.<span class="built_in">format</span>(mean_squared_error(oof_rfr_263, target)))</span><br></pre></td></tr></table></figure>
<p><strong>4. GradientBoostingDecisionTree 梯度提升决策树</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#GradientBoostingRegressor梯度提升决策树</span></span><br><span class="line">folds = StratifiedKFold(n_splits=<span class="number">5</span>, shuffle=<span class="literal">True</span>, random_state=<span class="number">2018</span>)</span><br><span class="line">oof_gbr_263 = np.zeros(train_shape)</span><br><span class="line">predictions_gbr_263 = np.zeros(<span class="built_in">len</span>(X_test_263))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> fold_, (trn_idx, val_idx) <span class="keyword">in</span> <span class="built_in">enumerate</span>(folds.split(X_train_263, y_train)):</span><br><span class="line">    print(<span class="string">&quot;fold n°&#123;&#125;&quot;</span>.<span class="built_in">format</span>(fold_+<span class="number">1</span>))</span><br><span class="line">    tr_x = X_train_263[trn_idx]</span><br><span class="line">    tr_y = y_train[trn_idx]</span><br><span class="line">    gbr_263 = gbr(n_estimators=<span class="number">400</span>, learning_rate=<span class="number">0.01</span>,subsample=<span class="number">0.65</span>,max_depth=<span class="number">7</span>, min_samples_leaf=<span class="number">20</span>,</span><br><span class="line">            max_features=<span class="number">0.22</span>,verbose=<span class="number">1</span>)</span><br><span class="line">    gbr_263.fit(tr_x,tr_y)</span><br><span class="line">    oof_gbr_263[val_idx] = gbr_263.predict(X_train_263[val_idx])</span><br><span class="line">    </span><br><span class="line">    predictions_gbr_263 += gbr_263.predict(X_test_263) / folds.n_splits</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;CV score: &#123;:&lt;8.8f&#125;&quot;</span>.<span class="built_in">format</span>(mean_squared_error(oof_gbr_263, target)))</span><br></pre></td></tr></table></figure>
<p><strong>5. ExtraTree 极端随机森林回归</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ExtraTreesRegressor 极端随机森林回归</span></span><br><span class="line">folds = KFold(n_splits=<span class="number">5</span>, shuffle=<span class="literal">True</span>, random_state=<span class="number">13</span>)</span><br><span class="line">oof_etr_263 = np.zeros(train_shape)</span><br><span class="line">predictions_etr_263 = np.zeros(<span class="built_in">len</span>(X_test_263))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> fold_, (trn_idx, val_idx) <span class="keyword">in</span> <span class="built_in">enumerate</span>(folds.split(X_train_263, y_train)):</span><br><span class="line">    print(<span class="string">&quot;fold n°&#123;&#125;&quot;</span>.<span class="built_in">format</span>(fold_+<span class="number">1</span>))</span><br><span class="line">    tr_x = X_train_263[trn_idx]</span><br><span class="line">    tr_y = y_train[trn_idx]</span><br><span class="line">    etr_263 = etr(n_estimators=<span class="number">1000</span>,max_depth=<span class="number">8</span>, min_samples_leaf=<span class="number">12</span>, min_weight_fraction_leaf=<span class="number">0.0</span>,</span><br><span class="line">            max_features=<span class="number">0.4</span>,verbose=<span class="number">1</span>,n_jobs=-<span class="number">1</span>)<span class="comment"># max_feature：划分时考虑的最大特征数</span></span><br><span class="line">    etr_263.fit(tr_x,tr_y)</span><br><span class="line">    oof_etr_263[val_idx] = etr_263.predict(X_train_263[val_idx])</span><br><span class="line">    </span><br><span class="line">    predictions_etr_263 += etr_263.predict(X_test_263) / folds.n_splits</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;CV score: &#123;:&lt;8.8f&#125;&quot;</span>.<span class="built_in">format</span>(mean_squared_error(oof_etr_263, target)))</span><br></pre></td></tr></table></figure>
<p>至此，我们得到了以上5种模型的预测结果以及模型架构及参数。其中在每一种特征工程中，进行5折的交叉验证，并重复两次（Kernel Ridge Regression，核脊回归），取得每一个特征数下的模型的结果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">train_stack2 = np.vstack([oof_lgb_263,oof_xgb_263,oof_gbr_263,oof_rfr_263,oof_etr_263]).transpose()</span><br><span class="line"><span class="comment"># transpose()函数的作用就是调换x,y,z的位置,也就是数组的索引值</span></span><br><span class="line">test_stack2 = np.vstack([predictions_lgb_263, predictions_xgb_263,predictions_gbr_263,predictions_rfr_263,predictions_etr_263]).transpose()</span><br><span class="line"></span><br><span class="line"><span class="comment">#交叉验证:5折，重复2次</span></span><br><span class="line">folds_stack = RepeatedKFold(n_splits=<span class="number">5</span>, n_repeats=<span class="number">2</span>, random_state=<span class="number">7</span>)</span><br><span class="line">oof_stack2 = np.zeros(train_stack2.shape[<span class="number">0</span>])</span><br><span class="line">predictions_lr2 = np.zeros(test_stack2.shape[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> fold_, (trn_idx, val_idx) <span class="keyword">in</span> <span class="built_in">enumerate</span>(folds_stack.split(train_stack2,target)):</span><br><span class="line">    print(<span class="string">&quot;fold &#123;&#125;&quot;</span>.<span class="built_in">format</span>(fold_))</span><br><span class="line">    trn_data, trn_y = train_stack2[trn_idx], target.iloc[trn_idx].values</span><br><span class="line">    val_data, val_y = train_stack2[val_idx], target.iloc[val_idx].values</span><br><span class="line">    <span class="comment">#Kernel Ridge Regression</span></span><br><span class="line">    lr2 = kr()</span><br><span class="line">    lr2.fit(trn_data, trn_y)</span><br><span class="line">    </span><br><span class="line">    oof_stack2[val_idx] = lr2.predict(val_data)</span><br><span class="line">    predictions_lr2 += lr2.predict(test_stack2) / <span class="number">10</span></span><br><span class="line">    </span><br><span class="line">mean_squared_error(target.values, oof_stack2)</span><br></pre></td></tr></table></figure>
<p>接下来对49维的特征数据和383维的特征数据进行上述263维特征数据相同的操作。</p>
<h3 id="网格搜索进行参数调整">5.6 网格搜索进行参数调整</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_iris</span><br><span class="line"><span class="keyword">from</span> sklearn.svm <span class="keyword">import</span> SVC</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"> </span><br><span class="line">iris = load_iris()</span><br><span class="line">X_train,X_test,y_train,y_test = train_test_split(iris.data,iris.target,random_state=<span class="number">0</span>)</span><br><span class="line">print(<span class="string">&quot;Size of training set:&#123;&#125; size of testing set:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(X_train.shape[<span class="number">0</span>],X_test.shape[<span class="number">0</span>]))</span><br><span class="line"> </span><br><span class="line"><span class="comment">####   1</span></span><br><span class="line">best_score = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> gamma <span class="keyword">in</span> [<span class="number">0.001</span>,<span class="number">0.01</span>,<span class="number">0.1</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">100</span>]:</span><br><span class="line">    <span class="keyword">for</span> C <span class="keyword">in</span> [<span class="number">0.001</span>,<span class="number">0.01</span>,<span class="number">0.1</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">100</span>]:</span><br><span class="line">        svm = SVC(gamma=gamma,C=C)<span class="comment">#对于每种参数可能的组合，进行一次训练；</span></span><br><span class="line">        svm.fit(X_train,y_train)</span><br><span class="line">        score = svm.score(X_test,y_test)</span><br><span class="line">        <span class="keyword">if</span> score &gt; best_score:<span class="comment">#找到表现最好的参数</span></span><br><span class="line">            best_score = score</span><br><span class="line">            best_parameters = &#123;<span class="string">&#x27;gamma&#x27;</span>:gamma,<span class="string">&#x27;C&#x27;</span>:C&#125;</span><br><span class="line">print(<span class="string">&quot;Best score:&#123;:.2f&#125;&quot;</span>.<span class="built_in">format</span>(best_score))</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment">####   2</span></span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GridSearchCV</span><br><span class="line"> </span><br><span class="line"><span class="comment">#把要调整的参数以及其候选值 列出来；</span></span><br><span class="line">param_grid = &#123;<span class="string">&quot;gamma&quot;</span>:[<span class="number">0.001</span>,<span class="number">0.01</span>,<span class="number">0.1</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">100</span>],</span><br><span class="line">             <span class="string">&quot;C&quot;</span>:[<span class="number">0.001</span>,<span class="number">0.01</span>,<span class="number">0.1</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">100</span>]&#125;</span><br><span class="line">print(<span class="string">&quot;Parameters:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(param_grid))</span><br><span class="line"> </span><br><span class="line">grid_search = GridSearchCV(SVC(),param_grid,cv=<span class="number">5</span>) <span class="comment">#实例化一个GridSearchCV类,cv交叉验证参数</span></span><br><span class="line">X_train,X_test,y_train,y_test = train_test_split(iris.data,iris.target,random_state=<span class="number">10</span>)</span><br><span class="line">grid_search.fit(X_train,y_train) <span class="comment">#训练，找到最优的参数，同时使用最优的参数实例化一个新的SVC estimator。</span></span><br><span class="line">print(<span class="string">&quot;Test set score:&#123;:.2f&#125;&quot;</span>.<span class="built_in">format</span>(grid_search.score(X_test,y_test)))</span><br><span class="line">print(<span class="string">&quot;Best parameters:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(grid_search.best_params_))</span><br><span class="line"></span><br><span class="line"><span class="comment">#SVM模型有两个非常重要的参数C与gamma。</span></span><br><span class="line"><span class="comment">#C是惩罚系数，即对误差的容忍度（间隔大小,分类准确度）。C越高，说明越不能容忍出现误差,容易过拟合。C越小，容易欠拟合。C过大或过小，泛化能力变差</span></span><br><span class="line"><span class="comment">#gamma是选择RBF函数作为kernel后，该函数自带的一个参数。隐含地决定了数据映射到新的特征空间后的分布，gamma越大，支持向量越少，gamma值越小，支持向量越多。支持向量的个数影响训练与预测的速度。</span></span><br><span class="line"><span class="comment">#两者独立</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Result:</span><br><span class="line">    </span><br><span class="line">Parameters:&#123;&#39;gamma&#39;: [0.001, 0.01, 0.1, 1, 10, 100], &#39;C&#39;: [0.001, 0.01, 0.1, 1, 10, 100]&#125;</span><br><span class="line">Test set score:0.97</span><br><span class="line">Best parameters:&#123;&#39;C&#39;: 10, &#39;gamma&#39;: 0.1&#125;</span><br><span class="line">Best score on train set:0.98</span><br><span class="line"></span><br><span class="line">#Grid Search 调参方法存在的共性弊端就是：耗时；参数越多，候选值越多，耗费时间越长！所以，一般情况下，先定一个大范围，然后再细化。</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">李子梅</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://lzmcosmos.github.io/2021/05/14/Stacking-of-Emotion/">https://lzmcosmos.github.io/2021/05/14/Stacking-of-Emotion/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Stacking%E9%9B%86%E6%88%90%E5%AD%A6%E4%B9%A0%E6%A1%88%E4%BE%8B%E4%B8%80/">Stacking集成学习案例一</a><a class="post-meta__tags" href="/tags/%E5%B9%B8%E7%A6%8F%E6%84%9F%E9%A2%84%E6%B5%8B/">幸福感预测</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/05/14/Stacking-of-Steam/"><img class="prev-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Stacking集成学习案例二：蒸汽量预测</div></div></a></div><div class="next-post pull-right"><a href="/2021/05/11/Stacking/"><img class="next-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">集成学习之Stacking</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="twikoo"></div></div></div></div></div><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/cosmos.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">李子梅</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">92</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">111</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">9</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/LZMcosmos"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/LZMcosmos" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:609792588@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div></div><div class="card-widget card-announcement"><div class="card-content"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">“莱布尼茨在他的二进位算术中看到了宇宙创始的原像。他想象1表示上帝，而0表示虚无，上帝从虚无中创造出所有实物，恰如在他的数学系统中用1和0表示了所有的数。”</div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="card-content"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B9%B8%E7%A6%8F%E6%84%9F%E9%A2%84%E6%B5%8B"><span class="toc-number">1.</span> <span class="toc-text">幸福感预测</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B5%9B%E9%A2%98%E8%83%8C%E6%99%AF"><span class="toc-number">1.1.</span> <span class="toc-text">1 赛题背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B5%9B%E9%A2%98%E8%AF%B4%E6%98%8E"><span class="toc-number">1.2.</span> <span class="toc-text">2 赛题说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%AF%B4%E6%98%8E"><span class="toc-number">1.3.</span> <span class="toc-text">3 数据说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%84%E6%B5%8B%E6%8C%87%E6%A0%87"><span class="toc-number">1.4.</span> <span class="toc-text">4 评测指标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.5.</span> <span class="toc-text">5 案例分析和解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E9%A1%B9%E7%9B%AE%E6%89%80%E7%94%A8%E5%8C%85"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.1 导入项目所用包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">1.5.2.</span> <span class="toc-text">5.2 导入数据集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%B9%BF"><span class="toc-number">1.5.3.</span> <span class="toc-text">5.4 数据增广</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E5%BE%81%E5%BB%BA%E6%A8%A1"><span class="toc-number">1.5.4.</span> <span class="toc-text">5.5 特征建模</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E6%A0%BC%E6%90%9C%E7%B4%A2%E8%BF%9B%E8%A1%8C%E5%8F%82%E6%95%B0%E8%B0%83%E6%95%B4"><span class="toc-number">1.5.5.</span> <span class="toc-text">5.6 网格搜索进行参数调整</span></a></li></ol></li></ol></li></ol></div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/03/23/mysql-set/" title="MySQL之集合运算">MySQL之集合运算</a><time datetime="2022-03-23T14:31:51.000Z" title="Created 2022-03-23 22:31:51">2022-03-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/03/20/mysql-select-pro/" title="MySQL之进阶查询">MySQL之进阶查询</a><time datetime="2022-03-20T11:17:27.000Z" title="Created 2022-03-20 19:17:27">2022-03-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/03/16/mysql-select/" title="MySQL之基础查询与排序">MySQL之基础查询与排序</a><time datetime="2022-03-16T02:13:02.000Z" title="Created 2022-03-16 10:13:02">2022-03-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/03/13/Mysql%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E5%85%A5%E9%97%A8/" title="MySQL环境搭建与入门">MySQL环境搭建与入门</a><time datetime="2022-03-13T01:08:47.000Z" title="Created 2022-03-13 09:08:47">2022-03-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2021/11/01/CRF/" title="条件随机场（CRF）">条件随机场（CRF）</a><time datetime="2021-11-01T03:28:44.000Z" title="Created 2021-11-01 11:28:44">2021-11-01</time></div></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/Nebula_planets-Universe.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 李子梅</div><div class="footer_custom_text">welcome to my <a href="https://lzmcosmos.github.io/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    loader: {
      source: {
        '[tex]/amsCd': '[tex]/amscd'
      }
    },
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        addClass: [200,() => {
          document.querySelectorAll('mjx-container:not([display=\'true\']').forEach( node => {
            const target = node.parentNode
            if (!target.classList.contains('has-jax')) {
              target.classList.add('mathjax-overflow')
            }
          })
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>function loadTwikoo () {
  function init () {
    twikoo.init({ 
      envId: 'lzm-blog-8gx8fhrs09a28b34' 
    })
  }

  if (typeof twikoo.init === 'function') {
    init()
  } else {
    $.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js', init)
  }
}

if ('Twikoo' === 'Twikoo' || !false) {
  if (false) btf.loadComment(document.getElementById('twikoo'), loadTwikoo)
  else loadTwikoo()
} else {
  function loadOtherComment () {
    loadTwikoo()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script>(function(){
  const bp = document.createElement('script');
  const curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https'){
  bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  bp.dataset.pjax = ''
  const s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})()</script></div></body></html>