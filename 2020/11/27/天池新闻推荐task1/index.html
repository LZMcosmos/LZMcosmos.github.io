<!DOCTYPE html><html lang="zn-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>天池-新闻推荐之数据分析 | LZMcosmos</title><meta name="author" content="李子梅"><meta name="copyright" content="李子梅"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="天池新闻推荐——数据分析 数据分析 数据分析是解决一个数据科学问题的第一步。通过数据可视化观察数据，再根据情况进行数据预处理对数据进行清洗。 &gt; 解决数据科学问题的步骤：(源于大佬分享及自己的总结补充) * 数据可视化(观察数据) * 数据预处理(对数据进行清洗) * 文献等资料查阅解决问题的已有方式 * 建立模型，确定目标对象 * 特征工程 * 模型尝试(统计模型、树模型、神经网络)">
<meta property="og:type" content="article">
<meta property="og:title" content="天池-新闻推荐之数据分析">
<meta property="og:url" content="https://lzmcosmos.github.io/2020/11/27/%E5%A4%A9%E6%B1%A0%E6%96%B0%E9%97%BB%E6%8E%A8%E8%8D%90task1/index.html">
<meta property="og:site_name" content="LZMcosmos">
<meta property="og:description" content="天池新闻推荐——数据分析 数据分析 数据分析是解决一个数据科学问题的第一步。通过数据可视化观察数据，再根据情况进行数据预处理对数据进行清洗。 &gt; 解决数据科学问题的步骤：(源于大佬分享及自己的总结补充) * 数据可视化(观察数据) * 数据预处理(对数据进行清洗) * 文献等资料查阅解决问题的已有方式 * 建立模型，确定目标对象 * 特征工程 * 模型尝试(统计模型、树模型、神经网络)">
<meta property="og:locale" content="zn_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg">
<meta property="article:published_time" content="2020-11-27T14:54:12.000Z">
<meta property="article:modified_time" content="2021-03-04T00:57:33.543Z">
<meta property="article:author" content="李子梅">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="/img/cosmos.jpg"><link rel="canonical" href="https://lzmcosmos.github.io/2020/11/27/%E5%A4%A9%E6%B1%A0%E6%96%B0%E9%97%BB%E6%8E%A8%E8%8D%90task1/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="preconnect" href="//zz.bdstatic.com"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-03-04 08:57:33'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="generator" content="Hexo 5.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/cosmos.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">93</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">112</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">9</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/Nebula_planets-Universe.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">LZMcosmos</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><h1 class="post-title">天池-新闻推荐之数据分析</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2020-11-27T14:54:12.000Z" title="Created 2020-11-27 22:54:12">2020-11-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2021-03-04T00:57:33.543Z" title="Updated 2021-03-04 08:57:33">2021-03-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/">推荐系统</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="天池新闻推荐数据分析">天池新闻推荐——数据分析</h1>
<h2 id="数据分析">数据分析</h2>
<p>数据分析是解决一个数据科学问题的第一步。通过<strong>数据可视化</strong>观察数据，再根据情况进行<strong>数据预处理</strong>对数据进行清洗。 &gt; 解决数据科学问题的步骤：(源于大佬分享及自己的总结补充) * 数据可视化(观察数据) * 数据预处理(对数据进行清洗) * 文献等资料查阅解决问题的已有方式 * 建立模型，确定目标对象 * 特征工程 * 模型尝试(统计模型、树模型、神经网络) * 特征筛选 * 模型超参数调优 * 交叉验证与模型融合</p>
<h2 id="数据观察与数据分析">数据观察与数据分析</h2>
<h2 id="导入包">导入包</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line">plt.rc(<span class="string">&#x27;font&#x27;</span>, family=<span class="string">&#x27;SimHei&#x27;</span>, size=<span class="number">13</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os, gc, re, warnings, sys</span><br><span class="line">warnings.filterwarnings(<span class="string">&#x27;ignore&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="读取数据">读取数据</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># path = &#x27;/media/yons/sda2/raw_data/&#x27; # 本地路径</span></span><br><span class="line">path = <span class="string">&#x27;./raw_data/&#x27;</span> <span class="comment"># 本地路径</span></span><br><span class="line"></span><br><span class="line">trn_click = pd.read_csv(path+<span class="string">&#x27;train_click_log.csv&#x27;</span>)</span><br><span class="line">item_df = pd.read_csv(path+<span class="string">&#x27;articles.csv&#x27;</span>)</span><br><span class="line">item_df = item_df.rename(columns=&#123;<span class="string">&#x27;article_id&#x27;</span>: <span class="string">&#x27;click_article_id&#x27;</span>&#125;)</span><br><span class="line">item_emb_df = pd.read_csv(path+<span class="string">&#x27;articles_emb.csv&#x27;</span>)</span><br><span class="line"></span><br><span class="line">tst_click = pd.read_csv(path+<span class="string">&#x27;testA_click_log.csv&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="数据预处理">数据预处理</h2>
<ul>
<li>对每个用户根据用户点击的时间戳进行排序，增加rank列</li>
<li>计算每个用户点击文章的次数(也就是点击时间戳的数量)，增加click_cnts列</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">trn_click[<span class="string">&#x27;rank&#x27;</span>] = trn_click.groupby([<span class="string">&#x27;user_id&#x27;</span>])[<span class="string">&#x27;click_timestamp&#x27;</span>].rank(ascending=<span class="literal">False</span>).astype(<span class="built_in">int</span>)</span><br><span class="line">tst_click[<span class="string">&#x27;rank&#x27;</span>] = tst_click.groupby([<span class="string">&#x27;user_id&#x27;</span>])[<span class="string">&#x27;click_timestamp&#x27;</span>].rank(ascending=<span class="literal">False</span>).astype(<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line">trn_click[<span class="string">&#x27;click_cnts&#x27;</span>] = trn_click.groupby([<span class="string">&#x27;user_id&#x27;</span>])[<span class="string">&#x27;click_timestamp&#x27;</span>].transform(<span class="string">&#x27;count&#x27;</span>)</span><br><span class="line">tst_click[<span class="string">&#x27;click_cnts&#x27;</span>] = tst_click.groupby([<span class="string">&#x27;user_id&#x27;</span>])[<span class="string">&#x27;click_timestamp&#x27;</span>].transform(<span class="string">&#x27;count&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="观察数据">观察数据</h2>
<h3 id="训练集数据用户点击文章的日志文件">训练集数据：用户点击文章的日志文件</h3>
<p>查看时将用户点击文章的数据表和文章数据表根据article_id拼接</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">trn_click = trn_click.merge(item_df, how=<span class="string">&#x27;left&#x27;</span>, on=[<span class="string">&#x27;click_article_id&#x27;</span>])</span><br><span class="line">trn_click.head()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
user_id
</th>
<th>
click_article_id
</th>
<th>
click_timestamp
</th>
<th>
click_environment
</th>
<th>
click_deviceGroup
</th>
<th>
click_os
</th>
<th>
click_country
</th>
<th>
click_region
</th>
<th>
click_referrer_type
</th>
<th>
rank
</th>
<th>
click_cnts
</th>
<th>
category_id
</th>
<th>
created_at_ts
</th>
<th>
words_count
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
199999
</td>
<td>
160417
</td>
<td>
1507029570190
</td>
<td>
4
</td>
<td>
1
</td>
<td>
17
</td>
<td>
1
</td>
<td>
13
</td>
<td>
1
</td>
<td>
11
</td>
<td>
11
</td>
<td>
281
</td>
<td>
1506942089000
</td>
<td>
173
</td>
</tr>
<tr>
<th>
1
</th>
<td>
199999
</td>
<td>
5408
</td>
<td>
1507029571478
</td>
<td>
4
</td>
<td>
1
</td>
<td>
17
</td>
<td>
1
</td>
<td>
13
</td>
<td>
1
</td>
<td>
10
</td>
<td>
11
</td>
<td>
4
</td>
<td>
1506994257000
</td>
<td>
118
</td>
</tr>
<tr>
<th>
2
</th>
<td>
199999
</td>
<td>
50823
</td>
<td>
1507029601478
</td>
<td>
4
</td>
<td>
1
</td>
<td>
17
</td>
<td>
1
</td>
<td>
13
</td>
<td>
1
</td>
<td>
9
</td>
<td>
11
</td>
<td>
99
</td>
<td>
1507013614000
</td>
<td>
213
</td>
</tr>
<tr>
<th>
3
</th>
<td>
199998
</td>
<td>
157770
</td>
<td>
1507029532200
</td>
<td>
4
</td>
<td>
1
</td>
<td>
17
</td>
<td>
1
</td>
<td>
25
</td>
<td>
5
</td>
<td>
40
</td>
<td>
40
</td>
<td>
281
</td>
<td>
1506983935000
</td>
<td>
201
</td>
</tr>
<tr>
<th>
4
</th>
<td>
199998
</td>
<td>
96613
</td>
<td>
1507029671831
</td>
<td>
4
</td>
<td>
1
</td>
<td>
17
</td>
<td>
1
</td>
<td>
25
</td>
<td>
5
</td>
<td>
39
</td>
<td>
40
</td>
<td>
209
</td>
<td>
1506938444000
</td>
<td>
185
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trn_click.info()</span><br></pre></td></tr></table></figure>
<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 1112623 entries, 0 to 1112622
Data columns (total 14 columns):
user_id                1112623 non-null int64
click_article_id       1112623 non-null int64
click_timestamp        1112623 non-null int64
click_environment      1112623 non-null int64
click_deviceGroup      1112623 non-null int64
click_os               1112623 non-null int64
click_country          1112623 non-null int64
click_region           1112623 non-null int64
click_referrer_type    1112623 non-null int64
rank                   1112623 non-null int64
click_cnts             1112623 non-null int64
category_id            1112623 non-null int64
created_at_ts          1112623 non-null int64
words_count            1112623 non-null int64
dtypes: int64(14)
memory usage: 127.3 MB</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用户点击数据表的各列统计值</span></span><br><span class="line">trn_click.describe()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
user_id
</th>
<th>
click_article_id
</th>
<th>
click_timestamp
</th>
<th>
click_environment
</th>
<th>
click_deviceGroup
</th>
<th>
click_os
</th>
<th>
click_country
</th>
<th>
click_region
</th>
<th>
click_referrer_type
</th>
<th>
rank
</th>
<th>
click_cnts
</th>
<th>
category_id
</th>
<th>
created_at_ts
</th>
<th>
words_count
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
count
</th>
<td>
1.112623e+06
</td>
<td>
1.112623e+06
</td>
<td>
1.112623e+06
</td>
<td>
1.112623e+06
</td>
<td>
1.112623e+06
</td>
<td>
1.112623e+06
</td>
<td>
1.112623e+06
</td>
<td>
1.112623e+06
</td>
<td>
1.112623e+06
</td>
<td>
1.112623e+06
</td>
<td>
1.112623e+06
</td>
<td>
1.112623e+06
</td>
<td>
1.112623e+06
</td>
<td>
1.112623e+06
</td>
</tr>
<tr>
<th>
mean
</th>
<td>
1.221198e+05
</td>
<td>
1.951541e+05
</td>
<td>
1.507588e+12
</td>
<td>
3.947786e+00
</td>
<td>
1.815981e+00
</td>
<td>
1.301976e+01
</td>
<td>
1.310776e+00
</td>
<td>
1.813587e+01
</td>
<td>
1.910063e+00
</td>
<td>
7.118518e+00
</td>
<td>
1.323704e+01
</td>
<td>
3.056176e+02
</td>
<td>
1.506598e+12
</td>
<td>
2.011981e+02
</td>
</tr>
<tr>
<th>
std
</th>
<td>
5.540349e+04
</td>
<td>
9.292286e+04
</td>
<td>
3.363466e+08
</td>
<td>
3.276715e-01
</td>
<td>
1.035170e+00
</td>
<td>
6.967844e+00
</td>
<td>
1.618264e+00
</td>
<td>
7.105832e+00
</td>
<td>
1.220012e+00
</td>
<td>
1.016095e+01
</td>
<td>
1.631503e+01
</td>
<td>
1.155791e+02
</td>
<td>
8.343066e+09
</td>
<td>
5.223881e+01
</td>
</tr>
<tr>
<th>
min
</th>
<td>
0.000000e+00
</td>
<td>
3.000000e+00
</td>
<td>
1.507030e+12
</td>
<td>
1.000000e+00
</td>
<td>
1.000000e+00
</td>
<td>
2.000000e+00
</td>
<td>
1.000000e+00
</td>
<td>
1.000000e+00
</td>
<td>
1.000000e+00
</td>
<td>
1.000000e+00
</td>
<td>
2.000000e+00
</td>
<td>
1.000000e+00
</td>
<td>
1.166573e+12
</td>
<td>
0.000000e+00
</td>
</tr>
<tr>
<th>
25%
</th>
<td>
7.934700e+04
</td>
<td>
1.239090e+05
</td>
<td>
1.507297e+12
</td>
<td>
4.000000e+00
</td>
<td>
1.000000e+00
</td>
<td>
2.000000e+00
</td>
<td>
1.000000e+00
</td>
<td>
1.300000e+01
</td>
<td>
1.000000e+00
</td>
<td>
2.000000e+00
</td>
<td>
4.000000e+00
</td>
<td>
2.500000e+02
</td>
<td>
1.507220e+12
</td>
<td>
1.700000e+02
</td>
</tr>
<tr>
<th>
50%
</th>
<td>
1.309670e+05
</td>
<td>
2.038900e+05
</td>
<td>
1.507596e+12
</td>
<td>
4.000000e+00
</td>
<td>
1.000000e+00
</td>
<td>
1.700000e+01
</td>
<td>
1.000000e+00
</td>
<td>
2.100000e+01
</td>
<td>
2.000000e+00
</td>
<td>
4.000000e+00
</td>
<td>
8.000000e+00
</td>
<td>
3.280000e+02
</td>
<td>
1.507553e+12
</td>
<td>
1.970000e+02
</td>
</tr>
<tr>
<th>
75%
</th>
<td>
1.704010e+05
</td>
<td>
2.777120e+05
</td>
<td>
1.507841e+12
</td>
<td>
4.000000e+00
</td>
<td>
3.000000e+00
</td>
<td>
1.700000e+01
</td>
<td>
1.000000e+00
</td>
<td>
2.500000e+01
</td>
<td>
2.000000e+00
</td>
<td>
8.000000e+00
</td>
<td>
1.600000e+01
</td>
<td>
4.100000e+02
</td>
<td>
1.507756e+12
</td>
<td>
2.280000e+02
</td>
</tr>
<tr>
<th>
max
</th>
<td>
1.999990e+05
</td>
<td>
3.640460e+05
</td>
<td>
1.510603e+12
</td>
<td>
4.000000e+00
</td>
<td>
5.000000e+00
</td>
<td>
2.000000e+01
</td>
<td>
1.100000e+01
</td>
<td>
2.800000e+01
</td>
<td>
7.000000e+00
</td>
<td>
2.410000e+02
</td>
<td>
2.410000e+02
</td>
<td>
4.600000e+02
</td>
<td>
1.510666e+12
</td>
<td>
6.690000e+03
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 训练集中用户的数量</span></span><br><span class="line">trn_click.user_id.nunique()</span><br></pre></td></tr></table></figure>
<pre><code>200000</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 训练集中每个用户最少点击的文章数</span></span><br><span class="line">trn_click.groupby([<span class="string">&#x27;user_id&#x27;</span>])[<span class="string">&#x27;click_article_id&#x27;</span>].count().<span class="built_in">min</span>()</span><br></pre></td></tr></table></figure>
<pre><code>2</code></pre>
<h2 id="通过直方图观察用户点击日志文件的各列数据分布">通过直方图观察用户点击日志文件的各列数据分布</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">plt.figure()</span><br><span class="line">plt.figure(figsize=(<span class="number">15</span>, <span class="number">20</span>))</span><br><span class="line">i = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> col <span class="keyword">in</span> [<span class="string">&#x27;click_article_id&#x27;</span>, <span class="string">&#x27;click_timestamp&#x27;</span>, <span class="string">&#x27;click_environment&#x27;</span>, <span class="string">&#x27;click_deviceGroup&#x27;</span>, <span class="string">&#x27;click_os&#x27;</span>, <span class="string">&#x27;click_country&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;click_region&#x27;</span>, <span class="string">&#x27;click_referrer_type&#x27;</span>, <span class="string">&#x27;rank&#x27;</span>, <span class="string">&#x27;click_cnts&#x27;</span>]:</span><br><span class="line">    plot_envs = plt.subplot(<span class="number">5</span>, <span class="number">2</span>, i) <span class="comment"># 子图一共5行2列，i是图的索引（1就是第一个，2就是第二个）</span></span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    v = trn_click[col].value_counts().reset_index()[:<span class="number">10</span>]</span><br><span class="line">    fig = sns.barplot(x=v[<span class="string">&#x27;index&#x27;</span>], y=v[col])</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> fig.get_xticklabels():</span><br><span class="line">        f=item.set_rotation(<span class="number">90</span>)</span><br><span class="line">    plt.title(col)</span><br><span class="line">plt.tight_layout()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<pre><code>&lt;Figure size 432x288 with 0 Axes&gt;</code></pre>
<figure>
<img src="/img/output_15_1.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<p><strong>分析</strong> * 从点击时间clik_timestamp来看，分布较为平均，可不做特殊处理。由于时间戳是13位的，后续将时间格式转换成10位方便计算。</p>
<ul>
<li><p>从点击环境click_environment来看，仅有1922次（占0.1%）点击环境为1；仅有24617次（占2.3%）点击环境为2；剩余（占97.6%）点击环境为4。</p></li>
<li><p>从点击设备组click_deviceGroup来看，设备1占大部分（60.4%），设备3占36%。</p></li>
</ul>
<h2 id="测试集用户点击日志">测试集用户点击日志</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tst_click = tst_click.merge(item_df, how=<span class="string">&#x27;left&#x27;</span>, on=[<span class="string">&#x27;click_article_id&#x27;</span>])</span><br><span class="line">tst_click.head()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
user_id
</th>
<th>
click_article_id
</th>
<th>
click_timestamp
</th>
<th>
click_environment
</th>
<th>
click_deviceGroup
</th>
<th>
click_os
</th>
<th>
click_country
</th>
<th>
click_region
</th>
<th>
click_referrer_type
</th>
<th>
rank
</th>
<th>
click_cnts
</th>
<th>
category_id
</th>
<th>
created_at_ts
</th>
<th>
words_count
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
249999
</td>
<td>
160974
</td>
<td>
1506959142820
</td>
<td>
4
</td>
<td>
1
</td>
<td>
17
</td>
<td>
1
</td>
<td>
13
</td>
<td>
2
</td>
<td>
19
</td>
<td>
19
</td>
<td>
281
</td>
<td>
1506912747000
</td>
<td>
259
</td>
</tr>
<tr>
<th>
1
</th>
<td>
249999
</td>
<td>
160417
</td>
<td>
1506959172820
</td>
<td>
4
</td>
<td>
1
</td>
<td>
17
</td>
<td>
1
</td>
<td>
13
</td>
<td>
2
</td>
<td>
18
</td>
<td>
19
</td>
<td>
281
</td>
<td>
1506942089000
</td>
<td>
173
</td>
</tr>
<tr>
<th>
2
</th>
<td>
249998
</td>
<td>
160974
</td>
<td>
1506959056066
</td>
<td>
4
</td>
<td>
1
</td>
<td>
12
</td>
<td>
1
</td>
<td>
13
</td>
<td>
2
</td>
<td>
5
</td>
<td>
5
</td>
<td>
281
</td>
<td>
1506912747000
</td>
<td>
259
</td>
</tr>
<tr>
<th>
3
</th>
<td>
249998
</td>
<td>
202557
</td>
<td>
1506959086066
</td>
<td>
4
</td>
<td>
1
</td>
<td>
12
</td>
<td>
1
</td>
<td>
13
</td>
<td>
2
</td>
<td>
4
</td>
<td>
5
</td>
<td>
327
</td>
<td>
1506938401000
</td>
<td>
219
</td>
</tr>
<tr>
<th>
4
</th>
<td>
249997
</td>
<td>
183665
</td>
<td>
1506959088613
</td>
<td>
4
</td>
<td>
1
</td>
<td>
17
</td>
<td>
1
</td>
<td>
15
</td>
<td>
5
</td>
<td>
7
</td>
<td>
7
</td>
<td>
301
</td>
<td>
1500895686000
</td>
<td>
256
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tst_click.describe()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
user_id
</th>
<th>
click_article_id
</th>
<th>
click_timestamp
</th>
<th>
click_environment
</th>
<th>
click_deviceGroup
</th>
<th>
click_os
</th>
<th>
click_country
</th>
<th>
click_region
</th>
<th>
click_referrer_type
</th>
<th>
rank
</th>
<th>
click_cnts
</th>
<th>
category_id
</th>
<th>
created_at_ts
</th>
<th>
words_count
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
count
</th>
<td>
518010.000000
</td>
<td>
518010.000000
</td>
<td>
5.180100e+05
</td>
<td>
518010.000000
</td>
<td>
518010.000000
</td>
<td>
518010.000000
</td>
<td>
518010.000000
</td>
<td>
518010.000000
</td>
<td>
518010.000000
</td>
<td>
518010.000000
</td>
<td>
518010.000000
</td>
<td>
518010.000000
</td>
<td>
5.180100e+05
</td>
<td>
518010.000000
</td>
</tr>
<tr>
<th>
mean
</th>
<td>
227342.428169
</td>
<td>
193803.792550
</td>
<td>
1.507387e+12
</td>
<td>
3.947300
</td>
<td>
1.738285
</td>
<td>
13.628467
</td>
<td>
1.348209
</td>
<td>
18.250250
</td>
<td>
1.819614
</td>
<td>
15.521785
</td>
<td>
30.043586
</td>
<td>
305.324961
</td>
<td>
1.506883e+12
</td>
<td>
210.966331
</td>
</tr>
<tr>
<th>
std
</th>
<td>
14613.907188
</td>
<td>
88279.388177
</td>
<td>
3.706127e+08
</td>
<td>
0.323916
</td>
<td>
1.020858
</td>
<td>
6.625564
</td>
<td>
1.703524
</td>
<td>
7.060798
</td>
<td>
1.082657
</td>
<td>
33.957702
</td>
<td>
56.868021
</td>
<td>
110.411513
</td>
<td>
5.816668e+09
</td>
<td>
83.040065
</td>
</tr>
<tr>
<th>
min
</th>
<td>
200000.000000
</td>
<td>
137.000000
</td>
<td>
1.506959e+12
</td>
<td>
1.000000
</td>
<td>
1.000000
</td>
<td>
2.000000
</td>
<td>
1.000000
</td>
<td>
1.000000
</td>
<td>
1.000000
</td>
<td>
1.000000
</td>
<td>
1.000000
</td>
<td>
1.000000
</td>
<td>
1.265812e+12
</td>
<td>
0.000000
</td>
</tr>
<tr>
<th>
25%
</th>
<td>
214926.000000
</td>
<td>
128551.000000
</td>
<td>
1.507026e+12
</td>
<td>
4.000000
</td>
<td>
1.000000
</td>
<td>
12.000000
</td>
<td>
1.000000
</td>
<td>
13.000000
</td>
<td>
1.000000
</td>
<td>
4.000000
</td>
<td>
10.000000
</td>
<td>
252.000000
</td>
<td>
1.506970e+12
</td>
<td>
176.000000
</td>
</tr>
<tr>
<th>
50%
</th>
<td>
229109.000000
</td>
<td>
199197.000000
</td>
<td>
1.507308e+12
</td>
<td>
4.000000
</td>
<td>
1.000000
</td>
<td>
17.000000
</td>
<td>
1.000000
</td>
<td>
21.000000
</td>
<td>
2.000000
</td>
<td>
8.000000
</td>
<td>
19.000000
</td>
<td>
323.000000
</td>
<td>
1.507249e+12
</td>
<td>
199.000000
</td>
</tr>
<tr>
<th>
75%
</th>
<td>
240182.000000
</td>
<td>
272143.000000
</td>
<td>
1.507666e+12
</td>
<td>
4.000000
</td>
<td>
3.000000
</td>
<td>
17.000000
</td>
<td>
1.000000
</td>
<td>
25.000000
</td>
<td>
2.000000
</td>
<td>
18.000000
</td>
<td>
35.000000
</td>
<td>
399.000000
</td>
<td>
1.507630e+12
</td>
<td>
232.000000
</td>
</tr>
<tr>
<th>
max
</th>
<td>
249999.000000
</td>
<td>
364043.000000
</td>
<td>
1.508832e+12
</td>
<td>
4.000000
</td>
<td>
5.000000
</td>
<td>
20.000000
</td>
<td>
11.000000
</td>
<td>
28.000000
</td>
<td>
7.000000
</td>
<td>
938.000000
</td>
<td>
938.000000
</td>
<td>
460.000000
</td>
<td>
1.509949e+12
</td>
<td>
3082.000000
</td>
</tr>
</tbody>
</table>
</div>
<p>训练集和测试集的用户是完全不一样的,训练集的用户ID由0 ~ 199999，而测试集A的用户ID由200000 ~ 249999。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#测试集中的用户数量为5w</span></span><br><span class="line">tst_click.user_id.nunique()</span><br></pre></td></tr></table></figure>
<pre><code>50000</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tst_click.groupby(<span class="string">&#x27;user_id&#x27;</span>)[<span class="string">&#x27;click_article_id&#x27;</span>].count().<span class="built_in">min</span>() <span class="comment"># 注意测试集里面有只点击过一次文章的用户</span></span><br></pre></td></tr></table></figure>
<pre><code>1</code></pre>
<h2 id="新闻文章信息数据表">新闻文章信息数据表</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#新闻文章数据集浏览</span></span><br><span class="line">item_df.head().append(item_df.tail())</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
click_article_id
</th>
<th>
category_id
</th>
<th>
created_at_ts
</th>
<th>
words_count
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
0
</td>
<td>
0
</td>
<td>
1513144419000
</td>
<td>
168
</td>
</tr>
<tr>
<th>
1
</th>
<td>
1
</td>
<td>
1
</td>
<td>
1405341936000
</td>
<td>
189
</td>
</tr>
<tr>
<th>
2
</th>
<td>
2
</td>
<td>
1
</td>
<td>
1408667706000
</td>
<td>
250
</td>
</tr>
<tr>
<th>
3
</th>
<td>
3
</td>
<td>
1
</td>
<td>
1408468313000
</td>
<td>
230
</td>
</tr>
<tr>
<th>
4
</th>
<td>
4
</td>
<td>
1
</td>
<td>
1407071171000
</td>
<td>
162
</td>
</tr>
<tr>
<th>
364042
</th>
<td>
364042
</td>
<td>
460
</td>
<td>
1434034118000
</td>
<td>
144
</td>
</tr>
<tr>
<th>
364043
</th>
<td>
364043
</td>
<td>
460
</td>
<td>
1434148472000
</td>
<td>
463
</td>
</tr>
<tr>
<th>
364044
</th>
<td>
364044
</td>
<td>
460
</td>
<td>
1457974279000
</td>
<td>
177
</td>
</tr>
<tr>
<th>
364045
</th>
<td>
364045
</td>
<td>
460
</td>
<td>
1515964737000
</td>
<td>
126
</td>
</tr>
<tr>
<th>
364046
</th>
<td>
364046
</td>
<td>
460
</td>
<td>
1505811330000
</td>
<td>
479
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">item_df[<span class="string">&#x27;words_count&#x27;</span>].value_counts()</span><br></pre></td></tr></table></figure>
<pre><code>176     3485
182     3480
179     3463
178     3458
174     3456
183     3432
184     3427
173     3414
180     3403
177     3391
170     3387
187     3355
169     3352
185     3348
175     3346
181     3330
186     3328
189     3327
171     3327
172     3322
165     3308
188     3288
167     3269
190     3261
192     3257
168     3248
193     3225
166     3199
191     3182
194     3164
        ... 
601        1
857        1
1977       1
1626       1
697        1
1720       1
696        1
706        1
592        1
1605       1
586        1
582        1
1606       1
972        1
716        1
584        1
1608       1
715        1
841        1
968        1
964        1
587        1
1099       1
1355       1
711        1
845        1
710        1
965        1
847        1
1535       1
Name: words_count, Length: 866, dtype: int64</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(item_df[<span class="string">&#x27;category_id&#x27;</span>].nunique())     <span class="comment"># 461个文章主题</span></span><br><span class="line">item_df[<span class="string">&#x27;category_id&#x27;</span>].hist()</span><br></pre></td></tr></table></figure>
<pre><code>461





&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f92a1e03080&gt;</code></pre>
<figure>
<img src="/img/output_26_2.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">item_df.shape       <span class="comment"># 364047篇文章</span></span><br></pre></td></tr></table></figure>
<pre><code>(364047, 4)</code></pre>
<h2 id="新闻文章embedding向量表示">新闻文章embedding向量表示</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">item_emb_df.head()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
article_id
</th>
<th>
emb_0
</th>
<th>
emb_1
</th>
<th>
emb_2
</th>
<th>
emb_3
</th>
<th>
emb_4
</th>
<th>
emb_5
</th>
<th>
emb_6
</th>
<th>
emb_7
</th>
<th>
emb_8
</th>
<th>
...
</th>
<th>
emb_240
</th>
<th>
emb_241
</th>
<th>
emb_242
</th>
<th>
emb_243
</th>
<th>
emb_244
</th>
<th>
emb_245
</th>
<th>
emb_246
</th>
<th>
emb_247
</th>
<th>
emb_248
</th>
<th>
emb_249
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
0
</td>
<td>
-0.161183
</td>
<td>
-0.957233
</td>
<td>
-0.137944
</td>
<td>
0.050855
</td>
<td>
0.830055
</td>
<td>
0.901365
</td>
<td>
-0.335148
</td>
<td>
-0.559561
</td>
<td>
-0.500603
</td>
<td>
...
</td>
<td>
0.321248
</td>
<td>
0.313999
</td>
<td>
0.636412
</td>
<td>
0.169179
</td>
<td>
0.540524
</td>
<td>
-0.813182
</td>
<td>
0.286870
</td>
<td>
-0.231686
</td>
<td>
0.597416
</td>
<td>
0.409623
</td>
</tr>
<tr>
<th>
1
</th>
<td>
1
</td>
<td>
-0.523216
</td>
<td>
-0.974058
</td>
<td>
0.738608
</td>
<td>
0.155234
</td>
<td>
0.626294
</td>
<td>
0.485297
</td>
<td>
-0.715657
</td>
<td>
-0.897996
</td>
<td>
-0.359747
</td>
<td>
...
</td>
<td>
-0.487843
</td>
<td>
0.823124
</td>
<td>
0.412688
</td>
<td>
-0.338654
</td>
<td>
0.320786
</td>
<td>
0.588643
</td>
<td>
-0.594137
</td>
<td>
0.182828
</td>
<td>
0.397090
</td>
<td>
-0.834364
</td>
</tr>
<tr>
<th>
2
</th>
<td>
2
</td>
<td>
-0.619619
</td>
<td>
-0.972960
</td>
<td>
-0.207360
</td>
<td>
-0.128861
</td>
<td>
0.044748
</td>
<td>
-0.387535
</td>
<td>
-0.730477
</td>
<td>
-0.066126
</td>
<td>
-0.754899
</td>
<td>
...
</td>
<td>
0.454756
</td>
<td>
0.473184
</td>
<td>
0.377866
</td>
<td>
-0.863887
</td>
<td>
-0.383365
</td>
<td>
0.137721
</td>
<td>
-0.810877
</td>
<td>
-0.447580
</td>
<td>
0.805932
</td>
<td>
-0.285284
</td>
</tr>
<tr>
<th>
3
</th>
<td>
3
</td>
<td>
-0.740843
</td>
<td>
-0.975749
</td>
<td>
0.391698
</td>
<td>
0.641738
</td>
<td>
-0.268645
</td>
<td>
0.191745
</td>
<td>
-0.825593
</td>
<td>
-0.710591
</td>
<td>
-0.040099
</td>
<td>
...
</td>
<td>
0.271535
</td>
<td>
0.036040
</td>
<td>
0.480029
</td>
<td>
-0.763173
</td>
<td>
0.022627
</td>
<td>
0.565165
</td>
<td>
-0.910286
</td>
<td>
-0.537838
</td>
<td>
0.243541
</td>
<td>
-0.885329
</td>
</tr>
<tr>
<th>
4
</th>
<td>
4
</td>
<td>
-0.279052
</td>
<td>
-0.972315
</td>
<td>
0.685374
</td>
<td>
0.113056
</td>
<td>
0.238315
</td>
<td>
0.271913
</td>
<td>
-0.568816
</td>
<td>
0.341194
</td>
<td>
-0.600554
</td>
<td>
...
</td>
<td>
0.238286
</td>
<td>
0.809268
</td>
<td>
0.427521
</td>
<td>
-0.615932
</td>
<td>
-0.503697
</td>
<td>
0.614450
</td>
<td>
-0.917760
</td>
<td>
-0.424061
</td>
<td>
0.185484
</td>
<td>
-0.580292
</td>
</tr>
</tbody>
</table>
<p>
5 rows × 251 columns
</p>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">item_emb_df.shape</span><br></pre></td></tr></table></figure>
<pre><code>(364047, 251)</code></pre>
<h1 id="数据分析-1">数据分析</h1>
<h2 id="用户重复点击">用户重复点击</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># merge</span></span><br><span class="line">user_click_merge = trn_click.append(tst_click)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#用户重复点击</span></span><br><span class="line">user_click_count = user_click_merge.groupby([<span class="string">&#x27;user_id&#x27;</span>, <span class="string">&#x27;click_article_id&#x27;</span>])[<span class="string">&#x27;click_timestamp&#x27;</span>].agg(&#123;<span class="string">&#x27;count&#x27;</span>&#125;).reset_index()</span><br><span class="line">user_click_count[:<span class="number">10</span>]</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
user_id
</th>
<th>
click_article_id
</th>
<th>
count
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
0
</td>
<td>
30760
</td>
<td>
1
</td>
</tr>
<tr>
<th>
1
</th>
<td>
0
</td>
<td>
157507
</td>
<td>
1
</td>
</tr>
<tr>
<th>
2
</th>
<td>
1
</td>
<td>
63746
</td>
<td>
1
</td>
</tr>
<tr>
<th>
3
</th>
<td>
1
</td>
<td>
289197
</td>
<td>
1
</td>
</tr>
<tr>
<th>
4
</th>
<td>
2
</td>
<td>
36162
</td>
<td>
1
</td>
</tr>
<tr>
<th>
5
</th>
<td>
2
</td>
<td>
168401
</td>
<td>
1
</td>
</tr>
<tr>
<th>
6
</th>
<td>
3
</td>
<td>
36162
</td>
<td>
1
</td>
</tr>
<tr>
<th>
7
</th>
<td>
3
</td>
<td>
50644
</td>
<td>
1
</td>
</tr>
<tr>
<th>
8
</th>
<td>
4
</td>
<td>
39894
</td>
<td>
1
</td>
</tr>
<tr>
<th>
9
</th>
<td>
4
</td>
<td>
42567
</td>
<td>
1
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user_click_count[user_click_count[<span class="string">&#x27;count&#x27;</span>]&gt;<span class="number">7</span>]</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
user_id
</th>
<th>
click_article_id
</th>
<th>
count
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
311242
</th>
<td>
86295
</td>
<td>
74254
</td>
<td>
10
</td>
</tr>
<tr>
<th>
311243
</th>
<td>
86295
</td>
<td>
76268
</td>
<td>
10
</td>
</tr>
<tr>
<th>
393761
</th>
<td>
103237
</td>
<td>
205948
</td>
<td>
10
</td>
</tr>
<tr>
<th>
393763
</th>
<td>
103237
</td>
<td>
235689
</td>
<td>
10
</td>
</tr>
<tr>
<th>
576902
</th>
<td>
134850
</td>
<td>
69463
</td>
<td>
13
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user_click_count[<span class="string">&#x27;count&#x27;</span>].unique()</span><br></pre></td></tr></table></figure>
<pre><code>array([ 1,  2,  4,  3,  6,  5, 10,  7, 13])</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#用户点击新闻次数</span></span><br><span class="line">user_click_count.loc[:,<span class="string">&#x27;count&#x27;</span>].value_counts() </span><br></pre></td></tr></table></figure>
<pre><code>1     1605541
2       11621
3         422
4          77
5          26
6          12
10          4
7           3
13          1
Name: count, dtype: int64</code></pre>
<p>可以看出：有1605541（约占99.2%）的用户未重复阅读过文章，仅有极少数用户重复点击过某篇文章。 这个也可以单独制作成特征</p>
<h2 id="用户点击环境变化分析">用户点击环境变化分析</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_envs</span>(<span class="params">df, cols, r, c</span>):</span></span><br><span class="line">    plt.figure()</span><br><span class="line">    plt.figure(figsize=(<span class="number">10</span>, <span class="number">5</span>))</span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> cols:</span><br><span class="line">        plt.subplot(r, c, i)</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        v = df[col].value_counts().reset_index()</span><br><span class="line">        fig = sns.barplot(x=v[<span class="string">&#x27;index&#x27;</span>], y=v[col])</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> fig.get_xticklabels():</span><br><span class="line">            item.set_rotation(<span class="number">90</span>)</span><br><span class="line">        plt.title(col)</span><br><span class="line">    plt.tight_layout()</span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 分析用户点击环境变化是否明显，这里随机采样10个用户分析这些用户的点击环境分布</span></span><br><span class="line">sample_user_ids = np.random.choice(tst_click[<span class="string">&#x27;user_id&#x27;</span>].unique(), size=<span class="number">10</span>, replace=<span class="literal">False</span>)</span><br><span class="line">sample_users = user_click_merge[user_click_merge[<span class="string">&#x27;user_id&#x27;</span>].isin(sample_user_ids)]</span><br><span class="line">cols = [<span class="string">&#x27;click_environment&#x27;</span>,<span class="string">&#x27;click_deviceGroup&#x27;</span>, <span class="string">&#x27;click_os&#x27;</span>, <span class="string">&#x27;click_country&#x27;</span>, <span class="string">&#x27;click_region&#x27;</span>,<span class="string">&#x27;click_referrer_type&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> _, user_df <span class="keyword">in</span> sample_users.groupby(<span class="string">&#x27;user_id&#x27;</span>):</span><br><span class="line">    plot_envs(user_df, cols, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&lt;Figure size 432x288 with 0 Axes&gt;</code></pre>
<figure>
<img src="/img/output_40_1.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<pre><code>&lt;Figure size 432x288 with 0 Axes&gt;</code></pre>
<figure>
<img src="/img/output_40_3.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<pre><code>&lt;Figure size 432x288 with 0 Axes&gt;</code></pre>
<figure>
<img src="/img/output_40_5.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<pre><code>&lt;Figure size 432x288 with 0 Axes&gt;</code></pre>
<figure>
<img src="/img/output_40_7.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<pre><code>&lt;Figure size 432x288 with 0 Axes&gt;</code></pre>
<figure>
<img src="/img/output_40_9.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<pre><code>&lt;Figure size 432x288 with 0 Axes&gt;</code></pre>
<figure>
<img src="/img/output_40_11.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<pre><code>&lt;Figure size 432x288 with 0 Axes&gt;</code></pre>
<figure>
<img src="/img/output_40_13.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<pre><code>&lt;Figure size 432x288 with 0 Axes&gt;</code></pre>
<figure>
<img src="/img/output_40_15.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<pre><code>&lt;Figure size 432x288 with 0 Axes&gt;</code></pre>
<figure>
<img src="/img/output_40_17.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<pre><code>&lt;Figure size 432x288 with 0 Axes&gt;</code></pre>
<figure>
<img src="/img/output_40_19.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<p>可以看出绝大多数数的用户的点击环境是比较固定的。思路：可以基于这些环境的统计特征来代表该用户本身的属性</p>
<h2 id="用户点击新闻数量的分布">用户点击新闻数量的分布</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user_click_item_count = <span class="built_in">sorted</span>(user_click_merge.groupby(<span class="string">&#x27;user_id&#x27;</span>)[<span class="string">&#x27;click_article_id&#x27;</span>].count(), reverse=<span class="literal">True</span>)</span><br><span class="line">plt.plot(user_click_item_count)</span><br></pre></td></tr></table></figure>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x7f92a03e6cf8&gt;]</code></pre>
<figure>
<img src="/img/output_43_1.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<p>可以根据用户的点击文章次数看出用户的活跃度</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#点击次数在前50的用户</span></span><br><span class="line">plt.plot(user_click_item_count[:<span class="number">50</span>])</span><br></pre></td></tr></table></figure>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x7f92a0391ba8&gt;]</code></pre>
<figure>
<img src="/img/output_45_1.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<p>点击次数排前50的用户的点击次数都在100次以上。思路：我们可以定义点击次数大于等于100次的用户为活跃用户，这是一种简单的处理思路， 判断用户活跃度，更加全面的是再结合上点击时间，后面我们会基于点击次数和点击时间两个方面来判断用户活跃度。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#点击次数排名在[25000:50000]之间</span></span><br><span class="line">plt.plot(user_click_item_count[<span class="number">25000</span>:<span class="number">50000</span>])</span><br></pre></td></tr></table></figure>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x7f92a04d3240&gt;]</code></pre>
<figure>
<img src="/img/output_47_1.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<p>可以看出点击次数小于等于两次的用户非常的多，这些用户可以认为是非活跃用户。</p>
<h2 id="新闻点击次数分析">新闻点击次数分析</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">item_click_count = <span class="built_in">sorted</span>(user_click_merge.groupby(<span class="string">&#x27;click_article_id&#x27;</span>)[<span class="string">&#x27;user_id&#x27;</span>].count(), reverse=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.plot(item_click_count)</span><br></pre></td></tr></table></figure>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x7f92a014c4a8&gt;]</code></pre>
<figure>
<img src="/img/output_51_1.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.plot(item_click_count[:<span class="number">100</span>])</span><br></pre></td></tr></table></figure>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x7f92a1a04eb8&gt;]</code></pre>
<figure>
<img src="/img/output_52_1.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<p>可以看出点击次数最多的前100篇新闻，点击次数大于1000次</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.plot(item_click_count[:<span class="number">20</span>])</span><br></pre></td></tr></table></figure>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x7f92a1ad99e8&gt;]</code></pre>
<figure>
<img src="/img/output_54_1.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<p>点击次数最多的前20篇新闻，点击次数大于2500。思路：可以定义这些新闻为热门新闻， 这个也是简单的处理方式，后面我们也是根据点击次数和时间进行文章热度的一个划分。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.plot(item_click_count[<span class="number">3500</span>:])</span><br></pre></td></tr></table></figure>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x7f92a1c82208&gt;]</code></pre>
<figure>
<img src="/img/output_56_1.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<p>可以发现很多新闻只被点击过一两次。思路：可以定义这些新闻是冷门新闻</p>
<h2 id="新闻共现频次两篇新闻连续出现的次数">新闻共现频次：两篇新闻连续出现的次数</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tmp = user_click_merge.sort_values(<span class="string">&#x27;click_timestamp&#x27;</span>)</span><br><span class="line">tmp[<span class="string">&#x27;next_item&#x27;</span>] = tmp.groupby([<span class="string">&#x27;user_id&#x27;</span>])[<span class="string">&#x27;click_article_id&#x27;</span>].transform(<span class="keyword">lambda</span> x:x.shift(-<span class="number">1</span>))</span><br><span class="line">union_item = tmp.groupby([<span class="string">&#x27;click_article_id&#x27;</span>,<span class="string">&#x27;next_item&#x27;</span>])[<span class="string">&#x27;click_timestamp&#x27;</span>].agg(&#123;<span class="string">&#x27;count&#x27;</span>&#125;).reset_index().sort_values(<span class="string">&#x27;count&#x27;</span>, ascending=<span class="literal">False</span>)</span><br><span class="line">union_item[[<span class="string">&#x27;count&#x27;</span>]].describe()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
count
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
count
</th>
<td>
433597.000000
</td>
</tr>
<tr>
<th>
mean
</th>
<td>
3.184139
</td>
</tr>
<tr>
<th>
std
</th>
<td>
18.851753
</td>
</tr>
<tr>
<th>
min
</th>
<td>
1.000000
</td>
</tr>
<tr>
<th>
25%
</th>
<td>
1.000000
</td>
</tr>
<tr>
<th>
50%
</th>
<td>
1.000000
</td>
</tr>
<tr>
<th>
75%
</th>
<td>
2.000000
</td>
</tr>
<tr>
<th>
max
</th>
<td>
2202.000000
</td>
</tr>
</tbody>
</table>
</div>
<p>由统计数据可以看出，平均共现次数2.88，最高为1687。</p>
<p>说明用户看的新闻，相关性是比较强的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#画个图直观地看一看</span></span><br><span class="line">x = union_item[<span class="string">&#x27;click_article_id&#x27;</span>]</span><br><span class="line">y = union_item[<span class="string">&#x27;count&#x27;</span>]</span><br><span class="line">plt.scatter(x, y)</span><br></pre></td></tr></table></figure>
<pre><code>&lt;matplotlib.collections.PathCollection at 0x7f92a033cdd8&gt;</code></pre>
<figure>
<img src="/img/output_61_1.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.plot(union_item[<span class="string">&#x27;count&#x27;</span>].values[<span class="number">40000</span>:])</span><br></pre></td></tr></table></figure>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x7f92a0477d68&gt;]</code></pre>
<figure>
<img src="/img/output_62_1.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<p>大概有70000个pair至少共现一次</p>
<h2 id="新闻文章信息">新闻文章信息</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#不同类型的新闻出现的次数</span></span><br><span class="line">plt.plot(user_click_merge[<span class="string">&#x27;category_id&#x27;</span>].value_counts().values)</span><br></pre></td></tr></table></figure>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x7f92a02d1c50&gt;]</code></pre>
<figure>
<img src="/img/output_65_1.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#出现次数比较少的新闻类型, 有些新闻类型，基本上就出现过几次</span></span><br><span class="line">plt.plot(user_click_merge[<span class="string">&#x27;category_id&#x27;</span>].value_counts().values[<span class="number">150</span>:])</span><br></pre></td></tr></table></figure>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x7f9295dcdf28&gt;]</code></pre>
<figure>
<img src="/img/output_66_1.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#新闻字数的描述性统计</span></span><br><span class="line">user_click_merge[<span class="string">&#x27;words_count&#x27;</span>].describe()</span><br></pre></td></tr></table></figure>
<pre><code>count    1.630633e+06
mean     2.043012e+02
std      6.382198e+01
min      0.000000e+00
25%      1.720000e+02
50%      1.970000e+02
75%      2.290000e+02
max      6.690000e+03
Name: words_count, dtype: float64</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.plot(user_click_merge[<span class="string">&#x27;words_count&#x27;</span>].values)</span><br></pre></td></tr></table></figure>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x7f92a02c2390&gt;]</code></pre>
<figure>
<img src="/img/output_68_1.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<h2 id="用户点击的新闻类型的偏好">用户点击的新闻类型的偏好</h2>
<p>此特征可以用于度量用户的兴趣是否广泛。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.plot(<span class="built_in">sorted</span>(user_click_merge.groupby(<span class="string">&#x27;user_id&#x27;</span>)[<span class="string">&#x27;category_id&#x27;</span>].nunique(), reverse=<span class="literal">True</span>))</span><br></pre></td></tr></table></figure>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x7f92a0283cc0&gt;]</code></pre>
<figure>
<img src="/img/output_70_1.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<p>可以看出有一小部分用户阅读类型是极其广泛的，大部分人都处在20个新闻类型以下。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user_click_merge.groupby(<span class="string">&#x27;user_id&#x27;</span>)[<span class="string">&#x27;category_id&#x27;</span>].nunique().reset_index().describe()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
user_id
</th>
<th>
category_id
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
count
</th>
<td>
250000.000000
</td>
<td>
250000.000000
</td>
</tr>
<tr>
<th>
mean
</th>
<td>
124999.500000
</td>
<td>
4.573188
</td>
</tr>
<tr>
<th>
std
</th>
<td>
72168.927986
</td>
<td>
4.419800
</td>
</tr>
<tr>
<th>
min
</th>
<td>
0.000000
</td>
<td>
1.000000
</td>
</tr>
<tr>
<th>
25%
</th>
<td>
62499.750000
</td>
<td>
2.000000
</td>
</tr>
<tr>
<th>
50%
</th>
<td>
124999.500000
</td>
<td>
3.000000
</td>
</tr>
<tr>
<th>
75%
</th>
<td>
187499.250000
</td>
<td>
6.000000
</td>
</tr>
<tr>
<th>
max
</th>
<td>
249999.000000
</td>
<td>
95.000000
</td>
</tr>
</tbody>
</table>
</div>
<h2 id="用户查看文章的长度的分布">用户查看文章的长度的分布</h2>
<p>通过统计不同用户点击新闻的平均字数，这个可以反映用户是对长文更感兴趣还是对短文更感兴趣。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.plot(<span class="built_in">sorted</span>(user_click_merge.groupby(<span class="string">&#x27;user_id&#x27;</span>)[<span class="string">&#x27;words_count&#x27;</span>].mean(), reverse=<span class="literal">True</span>))</span><br></pre></td></tr></table></figure>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x7f9294f8c9b0&gt;]</code></pre>
<figure>
<img src="/img/output_74_1.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<p>可以发现有一小部分人看的文章平均词数非常高，也有一小部分人看的平均文章次数非常低。</p>
<p>大多数人偏好于阅读字数在200-400字之间的新闻。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#挑出大多数人的区间仔细看看</span></span><br><span class="line">plt.plot(<span class="built_in">sorted</span>(user_click_merge.groupby(<span class="string">&#x27;user_id&#x27;</span>)[<span class="string">&#x27;words_count&#x27;</span>].mean(), reverse=<span class="literal">True</span>)[<span class="number">1000</span>:<span class="number">45000</span>])</span><br></pre></td></tr></table></figure>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x7f925a255f98&gt;]</code></pre>
<figure>
<img src="/img/output_76_1.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<p>可以发现大多数人都是看250字以下的文章</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#更加详细的参数</span></span><br><span class="line">user_click_merge.groupby(<span class="string">&#x27;user_id&#x27;</span>)[<span class="string">&#x27;words_count&#x27;</span>].mean().reset_index().describe()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
user_id
</th>
<th>
words_count
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
count
</th>
<td>
250000.000000
</td>
<td>
250000.000000
</td>
</tr>
<tr>
<th>
mean
</th>
<td>
124999.500000
</td>
<td>
205.830189
</td>
</tr>
<tr>
<th>
std
</th>
<td>
72168.927986
</td>
<td>
47.174030
</td>
</tr>
<tr>
<th>
min
</th>
<td>
0.000000
</td>
<td>
8.000000
</td>
</tr>
<tr>
<th>
25%
</th>
<td>
62499.750000
</td>
<td>
187.500000
</td>
</tr>
<tr>
<th>
50%
</th>
<td>
124999.500000
</td>
<td>
202.000000
</td>
</tr>
<tr>
<th>
75%
</th>
<td>
187499.250000
</td>
<td>
217.750000
</td>
</tr>
<tr>
<th>
max
</th>
<td>
249999.000000
</td>
<td>
3434.500000
</td>
</tr>
</tbody>
</table>
</div>
<h2 id="用户点击新闻的时间分析">用户点击新闻的时间分析</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#为了更好的可视化，这里把时间进行归一化操作</span></span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br><span class="line">mm = MinMaxScaler()</span><br><span class="line">user_click_merge[<span class="string">&#x27;click_timestamp&#x27;</span>] = mm.fit_transform(user_click_merge[[<span class="string">&#x27;click_timestamp&#x27;</span>]])</span><br><span class="line">user_click_merge[<span class="string">&#x27;created_at_ts&#x27;</span>] = mm.fit_transform(user_click_merge[[<span class="string">&#x27;created_at_ts&#x27;</span>]])</span><br><span class="line"></span><br><span class="line">user_click_merge = user_click_merge.sort_values(<span class="string">&#x27;click_timestamp&#x27;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user_click_merge.head()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
user_id
</th>
<th>
click_article_id
</th>
<th>
click_timestamp
</th>
<th>
click_environment
</th>
<th>
click_deviceGroup
</th>
<th>
click_os
</th>
<th>
click_country
</th>
<th>
click_region
</th>
<th>
click_referrer_type
</th>
<th>
rank
</th>
<th>
click_cnts
</th>
<th>
category_id
</th>
<th>
created_at_ts
</th>
<th>
words_count
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
18
</th>
<td>
249990
</td>
<td>
162300
</td>
<td>
0.000000
</td>
<td>
4
</td>
<td>
3
</td>
<td>
20
</td>
<td>
1
</td>
<td>
25
</td>
<td>
2
</td>
<td>
5
</td>
<td>
5
</td>
<td>
281
</td>
<td>
0.989186
</td>
<td>
193
</td>
</tr>
<tr>
<th>
2
</th>
<td>
249998
</td>
<td>
160974
</td>
<td>
0.000002
</td>
<td>
4
</td>
<td>
1
</td>
<td>
12
</td>
<td>
1
</td>
<td>
13
</td>
<td>
2
</td>
<td>
5
</td>
<td>
5
</td>
<td>
281
</td>
<td>
0.989092
</td>
<td>
259
</td>
</tr>
<tr>
<th>
30
</th>
<td>
249985
</td>
<td>
160974
</td>
<td>
0.000003
</td>
<td>
4
</td>
<td>
1
</td>
<td>
17
</td>
<td>
1
</td>
<td>
8
</td>
<td>
2
</td>
<td>
8
</td>
<td>
8
</td>
<td>
281
</td>
<td>
0.989092
</td>
<td>
259
</td>
</tr>
<tr>
<th>
50
</th>
<td>
249979
</td>
<td>
162300
</td>
<td>
0.000004
</td>
<td>
4
</td>
<td>
1
</td>
<td>
17
</td>
<td>
1
</td>
<td>
25
</td>
<td>
2
</td>
<td>
2
</td>
<td>
2
</td>
<td>
281
</td>
<td>
0.989186
</td>
<td>
193
</td>
</tr>
<tr>
<th>
25
</th>
<td>
249988
</td>
<td>
160974
</td>
<td>
0.000004
</td>
<td>
4
</td>
<td>
1
</td>
<td>
17
</td>
<td>
1
</td>
<td>
21
</td>
<td>
2
</td>
<td>
17
</td>
<td>
17
</td>
<td>
281
</td>
<td>
0.989092
</td>
<td>
259
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mean_diff_time_func</span>(<span class="params">df, col</span>):</span></span><br><span class="line">    df = pd.DataFrame(df, columns=&#123;col&#125;)</span><br><span class="line">    df[<span class="string">&#x27;time_shift1&#x27;</span>] = df[col].shift(<span class="number">1</span>).fillna(<span class="number">0</span>)</span><br><span class="line">    df[<span class="string">&#x27;diff_time&#x27;</span>] = <span class="built_in">abs</span>(df[col] - df[<span class="string">&#x27;time_shift1&#x27;</span>])</span><br><span class="line">    <span class="keyword">return</span> df[<span class="string">&#x27;diff_time&#x27;</span>].mean()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 点击时间差的平均值</span></span><br><span class="line">mean_diff_click_time = user_click_merge.groupby(<span class="string">&#x27;user_id&#x27;</span>)[<span class="string">&#x27;click_timestamp&#x27;</span>, <span class="string">&#x27;created_at_ts&#x27;</span>].apply(<span class="keyword">lambda</span> x: mean_diff_time_func(x, <span class="string">&#x27;click_timestamp&#x27;</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.plot(<span class="built_in">sorted</span>(mean_diff_click_time.values, reverse=<span class="literal">True</span>))</span><br></pre></td></tr></table></figure>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x7f929880f4e0&gt;]</code></pre>
<figure>
<img src="/img/output_84_1.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<p>可以发现不同用户点击文章的时间差是有差异的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 前后点击文章的创建时间差的平均值</span></span><br><span class="line">mean_diff_created_time = user_click_merge.groupby(<span class="string">&#x27;user_id&#x27;</span>)[<span class="string">&#x27;click_timestamp&#x27;</span>, <span class="string">&#x27;created_at_ts&#x27;</span>].apply(<span class="keyword">lambda</span> x: mean_diff_time_func(x, <span class="string">&#x27;created_at_ts&#x27;</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.plot(<span class="built_in">sorted</span>(mean_diff_created_time.values, reverse=<span class="literal">True</span>))</span><br></pre></td></tr></table></figure>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x7f9298758fd0&gt;]</code></pre>
<figure>
<img src="/img/output_87_1.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<p>可以发现用户先后点击文章，文章的创建时间也是有差异的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用户前后点击文章的相似性分布</span></span><br><span class="line">item_idx_2_rawid_dict = <span class="built_in">dict</span>(<span class="built_in">zip</span>(item_emb_df[<span class="string">&#x27;article_id&#x27;</span>], item_emb_df.index))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">del</span> item_emb_df[<span class="string">&#x27;article_id&#x27;</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">item_emb_np = np.ascontiguousarray(item_emb_df.values, dtype=np.float32)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 随机选择5个用户，查看这些用户前后查看文章的相似性</span></span><br><span class="line">sub_user_ids = np.random.choice(user_click_merge.user_id.unique(), size=<span class="number">15</span>, replace=<span class="literal">False</span>)</span><br><span class="line">sub_user_info = user_click_merge[user_click_merge[<span class="string">&#x27;user_id&#x27;</span>].isin(sub_user_ids)]</span><br><span class="line"></span><br><span class="line">sub_user_info.head()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
user_id
</th>
<th>
click_article_id
</th>
<th>
click_timestamp
</th>
<th>
click_environment
</th>
<th>
click_deviceGroup
</th>
<th>
click_os
</th>
<th>
click_country
</th>
<th>
click_region
</th>
<th>
click_referrer_type
</th>
<th>
rank
</th>
<th>
click_cnts
</th>
<th>
category_id
</th>
<th>
created_at_ts
</th>
<th>
words_count
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
69935
</th>
<td>
223960
</td>
<td>
272143
</td>
<td>
0.005832
</td>
<td>
4
</td>
<td>
3
</td>
<td>
20
</td>
<td>
6
</td>
<td>
28
</td>
<td>
2
</td>
<td>
4
</td>
<td>
4
</td>
<td>
399
</td>
<td>
0.989235
</td>
<td>
184
</td>
</tr>
<tr>
<th>
69936
</th>
<td>
223960
</td>
<td>
160974
</td>
<td>
0.005852
</td>
<td>
4
</td>
<td>
3
</td>
<td>
20
</td>
<td>
6
</td>
<td>
28
</td>
<td>
1
</td>
<td>
3
</td>
<td>
4
</td>
<td>
281
</td>
<td>
0.989092
</td>
<td>
259
</td>
</tr>
<tr>
<th>
69937
</th>
<td>
223960
</td>
<td>
337082
</td>
<td>
0.005860
</td>
<td>
4
</td>
<td>
3
</td>
<td>
20
</td>
<td>
6
</td>
<td>
28
</td>
<td>
1
</td>
<td>
2
</td>
<td>
4
</td>
<td>
437
</td>
<td>
0.989214
</td>
<td>
163
</td>
</tr>
<tr>
<th>
75534
</th>
<td>
221873
</td>
<td>
166581
</td>
<td>
0.006673
</td>
<td>
4
</td>
<td>
1
</td>
<td>
17
</td>
<td>
1
</td>
<td>
25
</td>
<td>
2
</td>
<td>
9
</td>
<td>
9
</td>
<td>
289
</td>
<td>
0.989241
</td>
<td>
210
</td>
</tr>
<tr>
<th>
75535
</th>
<td>
221873
</td>
<td>
64329
</td>
<td>
0.006680
</td>
<td>
4
</td>
<td>
1
</td>
<td>
17
</td>
<td>
1
</td>
<td>
25
</td>
<td>
2
</td>
<td>
8
</td>
<td>
9
</td>
<td>
134
</td>
<td>
0.989259
</td>
<td>
199
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_item_sim_list</span>(<span class="params">df</span>):</span></span><br><span class="line">    sim_list = []</span><br><span class="line">    item_list = df[<span class="string">&#x27;click_article_id&#x27;</span>].values</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(item_list)-<span class="number">1</span>):</span><br><span class="line">        emb1 = item_emb_np[item_idx_2_rawid_dict[item_list[i]]]</span><br><span class="line">        emb2 = item_emb_np[item_idx_2_rawid_dict[item_list[i+<span class="number">1</span>]]]</span><br><span class="line">        sim_list.append(np.dot(emb1,emb2)/(np.linalg.norm(emb1)*(np.linalg.norm(emb2))))</span><br><span class="line">    sim_list.append(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> sim_list</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> _, user_df <span class="keyword">in</span> sub_user_info.groupby(<span class="string">&#x27;user_id&#x27;</span>):</span><br><span class="line">    item_sim_list = get_item_sim_list(user_df)</span><br><span class="line">    plt.plot(item_sim_list)</span><br></pre></td></tr></table></figure>
<figure>
<img src="/img/output_94_0.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<p>可以看出有些用户前后看的商品的相似度波动比较大，有些波动比较小，也是有一定的区分度的。</p>
<h2 id="总结">总结</h2>
<ol type="1">
<li>训练集和测试集的用户id没有重复，也就是测试集里面的用户模型是没有见过的</li>
<li>训练集中用户最少的点击文章数是2， 而测试集里面用户最少的点击文章数是1</li>
<li>用户对于文章存在重复点击的情况， 但这个都存在于训练集里面</li>
<li>同一用户的点击环境存在不唯一的情况，后面做这部分特征的时候可以采用统计特征</li>
<li>用户点击文章的次数有很大的区分度，后面可以根据这个制作衡量用户活跃度的特征</li>
<li>文章被用户点击的次数也有很大的区分度，后面可以根据这个制作衡量文章热度的特征</li>
<li>用户看的新闻，相关性是比较强的，所以往往我们判断用户是否对某篇文章感兴趣的时候， 在很大程度上会和他历史点击过的文章有关</li>
<li>用户点击的文章字数有比较大的区别， 这个可以反映用户对于文章字数的区别</li>
<li>用户点击过的文章主题也有很大的区别， 这个可以反映用户的主题偏好</li>
<li>不同用户点击文章的时间差也会有所区别， 这个可以反映用户对于文章时效性的偏好</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">李子梅</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://lzmcosmos.github.io/2020/11/27/%E5%A4%A9%E6%B1%A0%E6%96%B0%E9%97%BB%E6%8E%A8%E8%8D%90task1/">https://lzmcosmos.github.io/2020/11/27/%E5%A4%A9%E6%B1%A0%E6%96%B0%E9%97%BB%E6%8E%A8%E8%8D%90task1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/11/30/%E5%A4%A9%E6%B1%A0%E6%96%B0%E9%97%BB%E6%8E%A8%E8%8D%90task2/"><img class="prev-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">天池-新闻推荐之多路召回</div></div></a></div><div class="next-post pull-right"><a href="/2020/11/27/DataStructure/"><img class="next-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Data Structure</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="twikoo"></div></div></div></div></div><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/cosmos.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">李子梅</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">93</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">112</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">9</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/LZMcosmos"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/LZMcosmos" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:609792588@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div></div><div class="card-widget card-announcement"><div class="card-content"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">“莱布尼茨在他的二进位算术中看到了宇宙创始的原像。他想象1表示上帝，而0表示虚无，上帝从虚无中创造出所有实物，恰如在他的数学系统中用1和0表示了所有的数。”</div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="card-content"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%A9%E6%B1%A0%E6%96%B0%E9%97%BB%E6%8E%A8%E8%8D%90%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">天池新闻推荐——数据分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90"><span class="toc-number">1.1.</span> <span class="toc-text">数据分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%A7%82%E5%AF%9F%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90"><span class="toc-number">1.2.</span> <span class="toc-text">数据观察与数据分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E5%8C%85"><span class="toc-number">1.3.</span> <span class="toc-text">导入包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-number">1.4.</span> <span class="toc-text">读取数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86"><span class="toc-number">1.5.</span> <span class="toc-text">数据预处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%82%E5%AF%9F%E6%95%B0%E6%8D%AE"><span class="toc-number">1.6.</span> <span class="toc-text">观察数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%AD%E7%BB%83%E9%9B%86%E6%95%B0%E6%8D%AE%E7%94%A8%E6%88%B7%E7%82%B9%E5%87%BB%E6%96%87%E7%AB%A0%E7%9A%84%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6"><span class="toc-number">1.6.1.</span> <span class="toc-text">训练集数据：用户点击文章的日志文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E7%9B%B4%E6%96%B9%E5%9B%BE%E8%A7%82%E5%AF%9F%E7%94%A8%E6%88%B7%E7%82%B9%E5%87%BB%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E7%9A%84%E5%90%84%E5%88%97%E6%95%B0%E6%8D%AE%E5%88%86%E5%B8%83"><span class="toc-number">1.7.</span> <span class="toc-text">通过直方图观察用户点击日志文件的各列数据分布</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E9%9B%86%E7%94%A8%E6%88%B7%E7%82%B9%E5%87%BB%E6%97%A5%E5%BF%97"><span class="toc-number">1.8.</span> <span class="toc-text">测试集用户点击日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E9%97%BB%E6%96%87%E7%AB%A0%E4%BF%A1%E6%81%AF%E6%95%B0%E6%8D%AE%E8%A1%A8"><span class="toc-number">1.9.</span> <span class="toc-text">新闻文章信息数据表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E9%97%BB%E6%96%87%E7%AB%A0embedding%E5%90%91%E9%87%8F%E8%A1%A8%E7%A4%BA"><span class="toc-number">1.10.</span> <span class="toc-text">新闻文章embedding向量表示</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-1"><span class="toc-number">2.</span> <span class="toc-text">数据分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E9%87%8D%E5%A4%8D%E7%82%B9%E5%87%BB"><span class="toc-number">2.1.</span> <span class="toc-text">用户重复点击</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%82%B9%E5%87%BB%E7%8E%AF%E5%A2%83%E5%8F%98%E5%8C%96%E5%88%86%E6%9E%90"><span class="toc-number">2.2.</span> <span class="toc-text">用户点击环境变化分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%82%B9%E5%87%BB%E6%96%B0%E9%97%BB%E6%95%B0%E9%87%8F%E7%9A%84%E5%88%86%E5%B8%83"><span class="toc-number">2.3.</span> <span class="toc-text">用户点击新闻数量的分布</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E9%97%BB%E7%82%B9%E5%87%BB%E6%AC%A1%E6%95%B0%E5%88%86%E6%9E%90"><span class="toc-number">2.4.</span> <span class="toc-text">新闻点击次数分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E9%97%BB%E5%85%B1%E7%8E%B0%E9%A2%91%E6%AC%A1%E4%B8%A4%E7%AF%87%E6%96%B0%E9%97%BB%E8%BF%9E%E7%BB%AD%E5%87%BA%E7%8E%B0%E7%9A%84%E6%AC%A1%E6%95%B0"><span class="toc-number">2.5.</span> <span class="toc-text">新闻共现频次：两篇新闻连续出现的次数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E9%97%BB%E6%96%87%E7%AB%A0%E4%BF%A1%E6%81%AF"><span class="toc-number">2.6.</span> <span class="toc-text">新闻文章信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%82%B9%E5%87%BB%E7%9A%84%E6%96%B0%E9%97%BB%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%81%8F%E5%A5%BD"><span class="toc-number">2.7.</span> <span class="toc-text">用户点击的新闻类型的偏好</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E6%9F%A5%E7%9C%8B%E6%96%87%E7%AB%A0%E7%9A%84%E9%95%BF%E5%BA%A6%E7%9A%84%E5%88%86%E5%B8%83"><span class="toc-number">2.8.</span> <span class="toc-text">用户查看文章的长度的分布</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%82%B9%E5%87%BB%E6%96%B0%E9%97%BB%E7%9A%84%E6%97%B6%E9%97%B4%E5%88%86%E6%9E%90"><span class="toc-number">2.9.</span> <span class="toc-text">用户点击新闻的时间分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">2.10.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/03/25/mysql-pro/" title="MySQL之高级处理">MySQL之高级处理</a><time datetime="2022-03-25T13:23:29.000Z" title="Created 2022-03-25 21:23:29">2022-03-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/03/23/mysql-set/" title="MySQL之集合运算">MySQL之集合运算</a><time datetime="2022-03-23T14:31:51.000Z" title="Created 2022-03-23 22:31:51">2022-03-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/03/20/mysql-select-pro/" title="MySQL之进阶查询">MySQL之进阶查询</a><time datetime="2022-03-20T11:17:27.000Z" title="Created 2022-03-20 19:17:27">2022-03-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/03/16/mysql-select/" title="MySQL之基础查询与排序">MySQL之基础查询与排序</a><time datetime="2022-03-16T02:13:02.000Z" title="Created 2022-03-16 10:13:02">2022-03-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/03/13/Mysql%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E5%85%A5%E9%97%A8/" title="MySQL环境搭建与入门">MySQL环境搭建与入门</a><time datetime="2022-03-13T01:08:47.000Z" title="Created 2022-03-13 09:08:47">2022-03-13</time></div></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/Nebula_planets-Universe.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 李子梅</div><div class="footer_custom_text">welcome to my <a href="https://lzmcosmos.github.io/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    loader: {
      source: {
        '[tex]/amsCd': '[tex]/amscd'
      }
    },
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        addClass: [200,() => {
          document.querySelectorAll('mjx-container:not([display=\'true\']').forEach( node => {
            const target = node.parentNode
            if (!target.classList.contains('has-jax')) {
              target.classList.add('mathjax-overflow')
            }
          })
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>function loadTwikoo () {
  function init () {
    twikoo.init({ 
      envId: 'lzm-blog-8gx8fhrs09a28b34' 
    })
  }

  if (typeof twikoo.init === 'function') {
    init()
  } else {
    $.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js', init)
  }
}

if ('Twikoo' === 'Twikoo' || !false) {
  if (false) btf.loadComment(document.getElementById('twikoo'), loadTwikoo)
  else loadTwikoo()
} else {
  function loadOtherComment () {
    loadTwikoo()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script>(function(){
  const bp = document.createElement('script');
  const curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https'){
  bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  bp.dataset.pjax = ''
  const s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})()</script></div></body></html>